<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Sacha Chua's Emacs configuration</title>
<!-- 2014-04-09 Wed 10:57 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Sacha Chua" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://sachachua.com/blog/wp-content/themes/sacha-v3/foundation/css/foundation.min.css"></link>
<link rel="stylesheet" type="text/css" href="http://sachachua.com/org-export.css"></link>
<link rel="stylesheet" type="text/css" href="http://sachachua.com/blog/wp-content/themes/sacha-v3/style.css"></link>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Sacha Chua's Emacs configuration</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Configuration</a>
<ul>
<li><a href="#sec-1-1">Personal information</a></li>
<li><a href="#sec-1-2">Emacs initialization</a>
<ul>
<li><a href="#sec-1-2-1">Add my elisp directory and other files</a></li>
<li><a href="#sec-1-2-2">Load secrets</a></li>
<li><a href="#sec-1-2-3">Add package sources</a></li>
<li><a href="#sec-1-2-4">Byte-compile my init files to speed things up next time</a></li>
<li><a href="#sec-1-2-5">Install packages if necessary</a></li>
<li><a href="#sec-1-2-6">Share my Emacs configuration</a></li>
</ul>
</li>
<li><a href="#sec-1-3">General configuration</a>
<ul>
<li><a href="#sec-1-3-1">Backups</a></li>
<li><a href="#sec-1-3-2">Ace Jump mode</a></li>
<li><a href="#sec-1-3-3">Windows configuration</a></li>
<li><a href="#sec-1-3-4">Editing multiple things</a>
<ul>
<li><a href="#sec-1-3-4-1">Multiple cursors mode</a></li>
<li><a href="#sec-1-3-4-2">All</a></li>
</ul>
</li>
<li><a href="#sec-1-3-5">Edit list</a></li>
<li><a href="#sec-1-3-6">Little editing shortcuts</a>
<ul>
<li><a href="#sec-1-3-6-1">Navigation</a></li>
<li><a href="#sec-1-3-6-2">Helm</a></li>
<li><a href="#sec-1-3-6-3">Helm-swoop</a></li>
<li><a href="#sec-1-3-6-4">Windmove</a></li>
<li><a href="#sec-1-3-6-5">When I press Enter</a></li>
<li><a href="#sec-1-3-6-6">Searching based on the current word</a></li>
<li><a href="#sec-1-3-6-7">Tramp and editing files over SSH</a></li>
<li><a href="#sec-1-3-6-8">Minibuffer editing</a></li>
</ul>
</li>
<li><a href="#sec-1-3-7">Change "yes or no" to "y or n"</a></li>
<li><a href="#sec-1-3-8">Set up a white-on-black color scheme</a></li>
<li><a href="#sec-1-3-9">Frequently-accessed files</a></li>
<li><a href="#sec-1-3-10">Kill-ring management</a></li>
<li><a href="#sec-1-3-11">Key chords</a></li>
<li><a href="#sec-1-3-12">Better undo</a></li>
<li><a href="#sec-1-3-13">Tramp on Windows</a></li>
<li><a href="#sec-1-3-14">More keybindings! More! More!</a></li>
</ul>
</li>
<li><a href="#sec-1-4">Writing</a>
<ul>
<li><a href="#sec-1-4-1">Avoiding weasel words</a></li>
<li><a href="#sec-1-4-2">Unfill paragraph</a></li>
<li><a href="#sec-1-4-3">Dictionary</a></li>
</ul>
</li>
<li><a href="#sec-1-5">Org</a>
<ul>
<li><a href="#sec-1-5-1">Modules</a></li>
<li><a href="#sec-1-5-2">Keyboard shortcuts</a></li>
<li><a href="#sec-1-5-3">Navigation</a></li>
<li><a href="#sec-1-5-4">Taking notes</a>
<ul>
<li><a href="#sec-1-5-4-1">Templates</a></li>
<li><a href="#sec-1-5-4-2">Refiling</a></li>
<li><a href="#sec-1-5-4-3">Estimating WPM</a></li>
</ul>
</li>
<li><a href="#sec-1-5-5">Managing tasks</a>
<ul>
<li><a href="#sec-1-5-5-1">Track TODO state</a></li>
<li><a href="#sec-1-5-5-2">Strike through DONE headlines</a></li>
<li><a href="#sec-1-5-5-3">Projects</a></li>
<li><a href="#sec-1-5-5-4">Tag tasks</a></li>
<li><a href="#sec-1-5-5-5">Enable filtering by effort estimates</a></li>
<li><a href="#sec-1-5-5-6">Track time</a></li>
<li><a href="#sec-1-5-5-7">Habits</a></li>
</ul>
</li>
<li><a href="#sec-1-5-6">Estimating tasks</a></li>
<li><a href="#sec-1-5-7">Modifying org agenda so that I can display a subset of tasks</a></li>
<li><a href="#sec-1-5-8">Fixing relative dates</a></li>
<li><a href="#sec-1-5-9">Flexible scheduling of tasks</a></li>
<li><a href="#sec-1-5-10">Org agenda</a>
<ul>
<li><a href="#sec-1-5-10-1">Basic configuration</a></li>
<li><a href="#sec-1-5-10-2">Display projects with associated subtasks</a></li>
<li><a href="#sec-1-5-10-3">Org agenda custom commands</a></li>
<li><a href="#sec-1-5-10-4">Make it easy to mark a task as done</a></li>
<li><a href="#sec-1-5-10-5">Make it easy to mark a task as done and create a follow-up task</a></li>
<li><a href="#sec-1-5-10-6">Capture something based on the agenda</a></li>
<li><a href="#sec-1-5-10-7">Starting my weeks on Saturday</a></li>
<li><a href="#sec-1-5-10-8">Sorting by date and priority</a></li>
<li><a href="#sec-1-5-10-9">Preventing things from falling through the cracks</a></li>
</ul>
</li>
<li><a href="#weekly-review">Weekly review</a>
<ul>
<li><a href="#sec-1-5-11-1">Flickr extract</a></li>
<li><a href="#sec-1-5-11-2">Link-related convenience functions</a></li>
<li><a href="#sec-1-5-11-3">Evernote-related extract</a></li>
</ul>
</li>
<li><a href="#sec-1-5-12">Viewing, navigating, and editing the Org tree</a></li>
<li><a href="#sec-1-5-13">Fix timestamps in Flickr links</a></li>
<li><a href="#sec-1-5-14">Organize my blog index</a></li>
<li><a href="#sec-1-5-15">Publishing</a>
<ul>
<li><a href="#sec-1-5-15-1">Stylesheet / header</a></li>
<li><a href="#sec-1-5-15-2">Copy region</a></li>
<li><a href="#sec-1-5-15-3">UTF-8 checkboxes</a></li>
</ul>
</li>
<li><a href="#sec-1-5-16">Structure templates</a></li>
<li><a href="#sec-1-5-17">Quick links</a></li>
<li><a href="#sec-1-5-18">MobileOrg for Android</a></li>
<li><a href="#sec-1-5-19">Clocking</a></li>
<li><a href="#sec-1-5-20">Speed commands</a></li>
<li><a href="#sec-1-5-21">My files</a></li>
<li><a href="#sec-1-5-22">Attachments</a></li>
<li><a href="#sec-1-5-23">Encryption</a></li>
<li><a href="#sec-1-5-24">Counting</a></li>
<li><a href="#sec-1-5-25">Diagrams and graphics</a></li>
</ul>
</li>
<li><a href="#sec-1-6">Coding</a>
<ul>
<li><a href="#sec-1-6-1">General preferences</a></li>
<li><a href="#sec-1-6-2">Use Cygwin</a></li>
<li><a href="#sec-1-6-3">Drupal</a></li>
<li><a href="#sec-1-6-4">Expand region</a></li>
<li><a href="#sec-1-6-5">Tag files</a></li>
<li><a href="#sec-1-6-6">Emacs Lisp</a>
<ul>
<li><a href="#sec-1-6-6-1">Edebug</a></li>
<li><a href="#sec-1-6-6-2">Eldoc</a></li>
<li><a href="#sec-1-6-6-3">Refactoring</a></li>
<li><a href="#sec-1-6-6-4">Jumping to code</a></li>
</ul>
</li>
<li><a href="#sec-1-6-7">Snippets</a></li>
<li><a href="#sec-1-6-8">Show more information</a></li>
<li><a href="#sec-1-6-9">Don't show whitespace in diff, but show context</a></li>
<li><a href="#sec-1-6-10">Javascript</a></li>
<li><a href="#sec-1-6-11">NodeJS</a></li>
<li><a href="#sec-1-6-12">Magit</a></li>
</ul>
</li>
<li><a href="#sec-1-7">Ledger (personal finance)</a>
<ul>
<li><a href="#sec-1-7-1">Make it easier to review my credit card transactions</a></li>
</ul>
</li>
<li><a href="#sec-1-8">Fun and games</a>
<ul>
<li><a href="#sec-1-8-1">Typing of Emacs</a></li>
<li><a href="#sec-1-8-2">Internet Relay Chat</a></li>
</ul>
</li>
<li><a href="#sec-1-9">Statistics and data transformations</a>
<ul>
<li><a href="#sec-1-9-1">R</a></li>
<li><a href="#sec-1-9-2">Artrage</a></li>
<li><a href="#sec-1-9-3">Workrave</a></li>
<li><a href="#sec-1-9-4">Blog</a></li>
</ul>
</li>
<li><a href="#sec-1-10">Quantified Awesome</a></li>
<li><a href="#sec-1-11">Beeminder</a></li>
<li><a href="#sec-1-12">Workarounds</a>
<ul>
<li><a href="#sec-1-12-1">color-theme sometimes comes across lists. Odd!</a></li>
<li><a href="#sec-1-12-2">ido-sort-mtime stopped working when I upgraded to Windows 8</a></li>
<li><a href="#sec-1-12-3">Cygwin mogrify doesn't work for me, but ImageMagick does</a></li>
</ul>
</li>
<li><a href="#sec-1-13">Startup</a></li>
<li><a href="#sec-1-14">Backup</a></li>
<li><a href="#sec-1-15">UTF-8</a></li>
<li><a href="#sec-1-16">Help - guide-key</a></li>
<li><a href="#sec-1-17">History</a></li>
</ul>
</li>
<li><a href="#sec-2">Inactive/infrequent things</a>
<ul>
<li><a href="#sec-2-1">Autoconnect to IRC so that I don't forget</a></li>
<li><a href="#sec-2-2">Org - send things to the bottom of the list</a></li>
<li><a href="#sec-2-3">Previous weekly review</a></li>
<li><a href="#sec-2-4">Animation for Emacs chats</a></li>
<li><a href="#sec-2-5">Idle timer</a></li>
<li><a href="#sec-2-6">Old Flickr/Evernote export</a></li>
<li><a href="#sec-2-7">Presentation code for Emacs Conference</a></li>
<li><a href="#sec-2-8">Enable minibuffer completion</a></li>
<li><a href="#sec-2-9">Because I'm trying to use helm instead of ido&#x2026;</a>
<ul>
<li><a href="#sec-2-9-1">Ido-mode: Much better navigationy things</a></li>
<li><a href="#sec-2-9-2">Ido and Org</a></li>
<li><a href="#sec-2-9-3">Finding files</a></li>
</ul>
</li>
<li><a href="#sec-2-10">Keywiz - keyboard quizzes</a></li>
<li><a href="#sec-2-11">Work-in-progress: monthly review</a></li>
</ul>
</li>
<li><a href="#sec-3">Other nifty Emacs things I want to learn</a>
<ul>
<li><a href="#sec-3-1">Finding the closest Makefile</a>
<ul>
<li><a href="#sec-3-1-1">Answer</a></li>
</ul>
</li>
<li><a href="#sec-3-2">iedit</a></li>
<li><a href="#sec-3-3">Smartparens mode</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Configuration</h2>
<div class="outline-text-2" id="text-1">
<p>
Inspired by the <a href="http://eschulte.me/emacs24-starter-kit/#installation">Emacs Starter Kit</a>, I set up my configuration file
using Org-babel. Because my username is Sacha, I can save this as
Sacha.org in my <code>~/.emacs.d</code> directory to have it automatically load.
You could load it with <code>(org-babel-load-file "/path/to/file")</code>,
changing the path appropriately, but you'll probably want to tweak it
extensively first. 
</p>

<p>
This page: <a href="http://dl.dropbox.com/u/3968124/sacha-emacs.html">HTML</a> - <a href="http://dl.dropbox.com/u/3968124/sacha-emacs.org">Org</a> - <a href="https://dl.dropbox.com/u/3968124/sacha-emacs.el">.el</a>
</p>

<p>
To be precise, this is what's in my init.el:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">This sets up the load path so that we can override it</span>
(package-initialize nil)
<span class="org-comment-delimiter">;; </span><span class="org-comment">Override the packages with the git version of Org</span>
(add-to-list 'load-path <span class="org-string">"~/elisp/org-mode/lisp"</span>)
(add-to-list 'load-path <span class="org-string">"~/elisp/org-mode/contrib/lisp"</span>)
<span class="org-comment-delimiter">;; </span><span class="org-comment">Load the rest of the packages</span>
(package-initialize t)
(<span class="org-keyword">require</span> '<span class="org-constant">org</span>)
(<span class="org-keyword">require</span> '<span class="org-constant">ob-tangle</span>)
(org-babel-load-file (expand-file-name <span class="org-string">"~/.emacs.d/Sacha.org"</span>))
</pre>
</div>

<p>
If you're new to Emacs Lisp, you probably don't want to copy and paste
large chunks of this code. Instead, copy small parts of it (always
making sure to copy a complete set of parentheses) into your
<code>*scratch*</code> buffer or some other buffer in <code>emacs-lisp-mode</code>. Use <code>M-x
eval-buffer</code> to evaluate the code and see if you like the way that
Emacs behaves.
</p>

<p>
I've installed a lot of packages. See the <i>package sources</i> section to
add the repositories to your configuration. When you see <code>use-package</code>
and a package name you might like, you can use <code>M-x package-install</code>
to install the package of that name.
</p>
</div>

<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">Personal information</h3>
<div class="outline-text-3" id="text-1-1">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq user-full-name <span class="org-string">"Sacha Chua"</span>
      user-mail-address <span class="org-string">"sacha@sachachua.com"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">Emacs initialization</h3>
<div class="outline-text-3" id="text-1-2">
</div><div id="outline-container-sec-1-2-1" class="outline-4">
<h4 id="sec-1-2-1">Add my elisp directory and other files</h4>
<div class="outline-text-4" id="text-1-2-1">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(add-to-list 'load-path <span class="org-string">"~/.emacs.d"</span>)
(add-to-list 'load-path <span class="org-string">"~/elisp"</span>)
(add-to-list 'load-path <span class="org-string">"~/elisp/artbollocks-mode"</span>)
(<span class="org-keyword">require</span> '<span class="org-constant">use-package</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-2-2" class="outline-4">
<h4 id="sec-1-2-2">Load secrets</h4>
<div class="outline-text-4" id="text-1-2-2">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(load-file <span class="org-string">"~/.emacs.secrets"</span>)
</pre>
</div>

<p>
I keep slightly more sensitive information in a separate file so that I can easily publish my main configuration.
</p>
</div>
</div>
<div id="outline-container-sec-1-2-3" class="outline-4">
<h4 id="sec-1-2-3">Add package sources</h4>
<div class="outline-text-4" id="text-1-2-3">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(add-to-list 'package-archives '(<span class="org-string">"org"</span> . <span class="org-string">"http://orgmode.org/elpa/"</span>) t)
(add-to-list 'package-archives '(<span class="org-string">"melpa"</span> . <span class="org-string">"http://melpa.milkbox.net/packages/"</span>) t)
</pre>
</div>

<p>
Use <code>M-x package-refresh-contents</code> to reload the list of packages after adding these.
</p>
</div>
</div>
<div id="outline-container-sec-1-2-4" class="outline-4">
<h4 id="sec-1-2-4">Byte-compile my init files to speed things up next time</h4>
<div class="outline-text-4" id="text-1-2-4">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/byte-recompile</span> ()
  (interactive)
  (byte-recompile-directory <span class="org-string">"~/.emacs.d"</span> 0)
  (byte-recompile-directory <span class="org-string">"~/elisp"</span> 0))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-2-5" class="outline-4">
<h4 id="sec-1-2-5">Install packages if necessary</h4>
<div class="outline-text-4" id="text-1-2-5">
<p>
ELPA makes it easy to install packages without tracking down all the
different websites. Let's define a function that makes it easy to
install packages.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/package-install</span> (package <span class="org-type">&amp;optional</span> repository)
  <span class="org-doc">"Install PACKAGE if it has not yet been installed.</span>
<span class="org-doc">If REPOSITORY is specified, use that."</span>
  (<span class="org-keyword">unless</span> (package-installed-p package)
    (<span class="org-keyword">let</span> ((package-archives (<span class="org-keyword">if</span> repository
                                (list (assoc repository package-archives))
                              package-archives)))
    (package-install package))))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-2-6" class="outline-4">
<h4 id="sec-1-2-6">Share my Emacs configuration</h4>
<div class="outline-text-4" id="text-1-2-6">
<p>
This code gets around the fact that my config is called Sacha.org, but
I want it to export as sacha-emacs.org in my Dropbox's public
directory.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-share-emacs</span> ()
  <span class="org-doc">"Share my Emacs configuration."</span>
  (interactive)
  (<span class="org-keyword">let*</span> ((destination-dir <span class="org-string">"~/Dropbox/Public/"</span>)
         (destination-filename <span class="org-string">"sacha-emacs.org"</span>))
    (<span class="org-keyword">save-restriction</span>
      (<span class="org-keyword">save-excursion</span>
        (widen)
        (write-region (point-min) (point-max) (expand-file-name destination-filename destination-dir))
        (<span class="org-keyword">with-current-buffer</span> (find-file-noselect (expand-file-name
                                                  destination-filename destination-dir))
          (org-babel-tangle-file buffer-file-name 
                                 (expand-file-name
                                  <span class="org-string">"sacha-emacs.el"</span> destination-dir) <span class="org-string">"emacs-lisp"</span>)
          (org-html-export-to-html))))))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3">General configuration</h3>
<div class="outline-text-3" id="text-1-3">
</div><div id="outline-container-sec-1-3-1" class="outline-4">
<h4 id="sec-1-3-1">Backups</h4>
<div class="outline-text-4" id="text-1-3-1">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq backup-directory-alist `((<span class="org-string">"."</span> . <span class="org-string">"~/.emacs.d/backups"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3-2" class="outline-4">
<h4 id="sec-1-3-2"><a id="ID-56f173e7-d2a2-4589-84d7-c6b435c8a5f8"></a>Ace Jump mode&#xa0;&#xa0;&#xa0;<span class="tag"><span class="drill">drill</span></span></h4>
<div class="outline-text-4" id="text-1-3-2">
<p>
Quickly jump to a position in the current view.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">ace-jump-mode</span>
  <span class="org-builtin">:bind</span> (<span class="org-string">"C-c SPC"</span> . ace-jump-mode))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-3-3" class="outline-4">
<h4 id="sec-1-3-3"><a id="ID-440c0b9a-9068-450b-89a3-a20c8ec1f447"></a>Windows configuration&#xa0;&#xa0;&#xa0;<span class="tag"><span class="drill">drill</span></span></h4>
<div class="outline-text-4" id="text-1-3-3">
<div class="org-src-container">

<pre class="src src-emacs-lisp">  (<span class="org-keyword">use-package</span> <span class="org-constant">winner</span>
    <span class="org-builtin">:config</span> (winner-mode 1))

(<span class="org-keyword">when</span> window-system
  (tooltip-mode -1)
  (tool-bar-mode -1)
  (menu-bar-mode -1))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3-4" class="outline-4">
<h4 id="sec-1-3-4">Editing multiple things</h4>
<div class="outline-text-4" id="text-1-3-4">
</div><div id="outline-container-sec-1-3-4-1" class="outline-5">
<h5 id="sec-1-3-4-1"><a id="o2b:61b0ffae-669b-4360-98fd-a6f0ea6f018e"></a>Multiple cursors mode&#xa0;&#xa0;&#xa0;<span class="tag"><span class="drill">drill</span></span></h5>
<div class="outline-text-5" id="text-1-3-4-1">
<p>
I often define keyboard macros to process multiple lines in a region.
Maybe <code>multiple-cursors</code> will be an even better way. Looks promising!
<a href="http://emacsrocks.com/e13.html">See Emacs Rocks episode 13 (multiple-cursors) for a great demo</a>.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">multiple-cursors</span>
  <span class="org-builtin">:bind</span> 
   ((<span class="org-string">"C-&gt;"</span> . mc/mark-next-like-this)
    (<span class="org-string">"C-&lt;"</span> . mc/mark-previous-like-this)
    (<span class="org-string">"C-*"</span> . mc/mark-all-like-this)))
</pre>
</div>

<p>
Thanks to <a href="http://irreal.org/blog/?p=1733">Irreal</a> and <a href="http://planet.emacsen.org/">Planet Emacsen</a> for the link!
</p>
</div>
</div>
<div id="outline-container-sec-1-3-4-2" class="outline-5">
<h5 id="sec-1-3-4-2"><a id="ID-211c02ab-9a9c-4e81-bc95-ce8e48db67b1"></a>All&#xa0;&#xa0;&#xa0;<span class="tag"><span class="drill">drill</span></span></h5>
<div class="outline-text-5" id="text-1-3-4-2">
<p>
M-x all lets you edit all lines matching a given regexp.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">all</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-3-5" class="outline-4">
<h4 id="sec-1-3-5"><a id="ID-e9147cb0-bad0-421c-9396-4f9045d6ebbb"></a>Edit list&#xa0;&#xa0;&#xa0;<span class="tag"><span class="drill">drill</span></span></h4>
<div class="outline-text-4" id="text-1-3-5">
<p>
M-x edit-list makes it easier to edit an Emacs Lisp list.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">edit-list</span>
  <span class="org-builtin">:commands</span> edit-list)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-3-6" class="outline-4">
<h4 id="sec-1-3-6">Little editing shortcuts</h4>
<div class="outline-text-4" id="text-1-3-6">
</div><div id="outline-container-sec-1-3-6-1" class="outline-5">
<h5 id="sec-1-3-6-1">Navigation</h5>
<div class="outline-text-5" id="text-1-3-6-1">
<p>
In my world, sentences end with a single space. This makes
sentence navigation commands work for me.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq sentence-end-double-space nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3-6-2" class="outline-5">
<h5 id="sec-1-3-6-2">Helm</h5>
<div class="outline-text-5" id="text-1-3-6-2">
<p>
I'm trying to get the hang of using Helm for completing everything so
that I don't have to deal with different keybindings or approaches.
Setting <code>helm-input-idle-delay</code> to 0.1 (I want my results and I want
them now!) should cut down on the number of times I M-x and type in
the exact command name, hit RET, and then end up on the wrong command.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">helm</span>
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">progn</span> 
    (<span class="org-keyword">require</span> '<span class="org-constant">helm-config</span>) 
    (setq helm-candidate-number-limit 10)
    <span class="org-comment-delimiter">;; </span><span class="org-comment">From https://gist.github.com/antifuchs/9238468</span>
    (setq helm-idle-delay 0.0 <span class="org-comment-delimiter">; </span><span class="org-comment">update fast sources immediately (doesn't).</span>
          helm-input-idle-delay 0.01  <span class="org-comment-delimiter">; </span><span class="org-comment">this actually updates things</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">reeeelatively quickly.</span>
          helm-quick-update t
          helm-M-x-requires-pattern nil
          helm-ff-skip-boring-files t)
    (helm-mode))
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">progn</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">I don't like the way switch-to-buffer uses history, since</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">that confuses me when it comes to buffers I've already</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">killed. Let's use ido instead.</span>
    (add-to-list 'helm-completing-read-handlers-alist '(switch-to-buffer . ido)))
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-c h"</span> . helm-mini)))
(ido-mode -1)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3-6-3" class="outline-5">
<h5 id="sec-1-3-6-3">Helm-swoop</h5>
<div class="outline-text-5" id="text-1-3-6-3">
<p>
This promises to be a fast way to find things. Let's see if replacing isearch-forward will do the trick.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">helm-swoop</span>
 <span class="org-builtin">:bind</span> ((<span class="org-string">"C-s"</span> . isearch-forward) (<span class="org-string">"C-S-s"</span> . helm-swoop)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3-6-4" class="outline-5">
<h5 id="sec-1-3-6-4">Windmove</h5>
<div class="outline-text-5" id="text-1-3-6-4">
<p>
Windmove doesn't behave well with Org, so we need to use different keybindings.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">windmove</span>
  <span class="org-builtin">:bind</span>
  ((<span class="org-string">"&lt;f2&gt; &lt;right&gt;"</span> . windmove-right)
   (<span class="org-string">"&lt;f2&gt; &lt;left&gt;"</span> . windmove-left)
   (<span class="org-string">"&lt;f2&gt; &lt;up&gt;"</span> . windmove-up)
   (<span class="org-string">"&lt;f2&gt; &lt;down&gt;"</span> . windmove-down)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3-6-5" class="outline-5">
<h5 id="sec-1-3-6-5">When I press Enter</h5>
<div class="outline-text-5" id="text-1-3-6-5">
<p>
I almost always want to go to the right indentation on the next line.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(global-set-key (kbd <span class="org-string">"RET"</span>) 'newline-and-indent)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-3-6-6" class="outline-5">
<h5 id="sec-1-3-6-6">Searching based on the current word</h5>
<div class="outline-text-5" id="text-1-3-6-6">
<p>
This lets me search up and down.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/search-word-backward</span> ()
  <span class="org-doc">"Find the previous occurrence of the current word."</span>
  (interactive)
  (<span class="org-keyword">let</span> ((cur (point)))
    (skip-syntax-backward <span class="org-string">"w_"</span>)
    (goto-char
     (<span class="org-keyword">if</span> (re-search-backward (concat <span class="org-string">"\\_&lt;"</span> (current-word) <span class="org-string">"\\_&gt;"</span>) nil t)
         (match-beginning 0)
       cur))))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/search-word-forward</span> ()
  <span class="org-doc">"Find the next occurrence of the current word."</span>
  (interactive)
  (<span class="org-keyword">let</span> ((cur (point)))
    (skip-syntax-forward <span class="org-string">"w_"</span>)
    (goto-char
     (<span class="org-keyword">if</span> (re-search-forward (concat <span class="org-string">"\\_&lt;"</span> (current-word) <span class="org-string">"\\_&gt;"</span>) nil t)
         (match-beginning 0)
       cur))))
(global-set-key '[M-up] 'sacha/search-word-backward)
(global-set-key '[M-down] 'sacha/search-word-forward)
(<span class="org-keyword">defadvice</span> <span class="org-function-name">search-for-keyword</span> (around sacha activate)
  <span class="org-doc">"Match in a case-insensitive way."</span>
  (<span class="org-keyword">let</span> ((case-fold-search t))
    ad-do-it))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3-6-7" class="outline-5">
<h5 id="sec-1-3-6-7">Tramp and editing files over SSH</h5>
<div class="outline-text-5" id="text-1-3-6-7">
<p>
Emacs lets you edit files on remote servers, which is pretty darn
cool.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq tramp-default-method <span class="org-string">"ssh"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-3-6-8" class="outline-5">
<h5 id="sec-1-3-6-8">Minibuffer editing</h5>
<div class="outline-text-5" id="text-1-3-6-8">
<p>
Sometimes you want to be able to do fancy things with the text
that you're entering into the minibuffer. This binds <code>C-M-e</code> in a
minibuffer) so that you can edit the contents of the minibuffer
before submitting it.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">miniedit</span>
  <span class="org-builtin">:commands</span> minibuffer-edit
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">progn</span>
    (bind-key <span class="org-string">"\M-\C-e"</span> 'miniedit minibuffer-local-map)
    (bind-key <span class="org-string">"\M-\C-e"</span> 'miniedit minibuffer-local-ns-map)
    (bind-key <span class="org-string">"\M-\C-e"</span> 'miniedit minibuffer-local-completion-map)
    (bind-key <span class="org-string">"\M-\C-e"</span> 'miniedit minibuffer-local-must-match-map)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-3-7" class="outline-4">
<h4 id="sec-1-3-7">Change "yes or no" to "y or n"</h4>
<div class="outline-text-4" id="text-1-3-7">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(fset 'yes-or-no-p 'y-or-n-p)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-3-8" class="outline-4">
<h4 id="sec-1-3-8">Set up a white-on-black color scheme</h4>
<div class="outline-text-4" id="text-1-3-8">
<p>
I like white on black because I find it to be more restful. The
color-theme in ELPA is a little odd, though, so we define some advice to make
it work. Some things still aren't quite right, though.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice</span> <span class="org-function-name">color-theme-alist</span> (around sacha activate)
  (<span class="org-keyword">if</span> (ad-get-arg 0)
      ad-do-it
    nil))
(sacha/package-install 'color-theme)
(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/setup-color-theme</span> ()
  (interactive)
  (color-theme-solarized 'dark)
  (set-face-foreground 'secondary-selection <span class="org-string">"darkblue"</span>)
  (set-face-background 'secondary-selection <span class="org-string">"lightblue"</span>)
  (set-face-background 'font-lock-doc-face <span class="org-string">"black"</span>)
  (set-face-foreground 'font-lock-doc-face <span class="org-string">"wheat"</span>)
  (set-face-background 'font-lock-string-face <span class="org-string">"black"</span>))
(<span class="org-keyword">use-package</span> <span class="org-constant">color-theme</span>
  <span class="org-builtin">:init</span>
  (sacha/setup-color-theme))
</pre>
</div>

<p>
I sometimes need to switch to a lighter background for screenshots.
For that, I use <code>color-theme-vim</code>.
</p>
</div>
</div>
<div id="outline-container-sec-1-3-9" class="outline-4">
<h4 id="sec-1-3-9">Frequently-accessed files</h4>
<div class="outline-text-4" id="text-1-3-9">
<p>
Registers allow you to jump to a file or other location quickly. To
jump to a register, use <code>C-x r j</code> followed by the letter of the
register.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">dolist</span>
    (r `((?i (file . <span class="org-string">"~/.emacs.d/Sacha.org"</span>))
         (?o (file . <span class="org-string">"~/personal/organizer.org"</span>))
         (?w (file . <span class="org-string">"~/Dropbox/public/sharing/index.org"</span>))
         (?W (file . <span class="org-string">"~/Dropbox/public/blog.org"</span>))
         (?b (file . <span class="org-string">"~/personal/business.org"</span>))
         (?g (file . <span class="org-string">"~/Dropbox/public/evil-plans.org"</span>))
         ))
  (set-register (car r) (cadr r)))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-3-10" class="outline-4">
<h4 id="sec-1-3-10"><a id="ID-508ef5ff-f338-4cd6-8201-9bc76fa432e8"></a>Kill-ring management&#xa0;&#xa0;&#xa0;<span class="tag"><span class="drill">drill</span></span></h4>
<div class="outline-text-4" id="text-1-3-10">
<p>
Make sense of the kill ring
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(sacha/package-install 'browse-kill-ring)
(<span class="org-keyword">use-package</span> <span class="org-constant">browse-kill-ring</span>
  <span class="org-builtin">:init</span> 
  (<span class="org-keyword">progn</span> 
    (browse-kill-ring-default-keybindings) <span class="org-comment-delimiter">;; </span><span class="org-comment">M-y</span>
    (setq browse-kill-ring-quit-action 'save-and-restore)))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-3-11" class="outline-4">
<h4 id="sec-1-3-11">Key chords</h4>
<div class="outline-text-4" id="text-1-3-11">
<p>
I'm on a Dvorak keyboard, so these might not work for you.
Experimenting with this!
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">key-chord</span>
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">progn</span> 
    (key-chord-mode 1)
    (key-chord-define-global <span class="org-string">"cg"</span>     'undo)
    (key-chord-define-global <span class="org-string">"yp"</span>     'other-window)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3-12" class="outline-4">
<h4 id="sec-1-3-12">Better undo</h4>
<div class="outline-text-4" id="text-1-3-12">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">undo-tree</span>
  <span class="org-builtin">:init</span> (global-undo-tree-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-3-13" class="outline-4">
<h4 id="sec-1-3-13">Tramp on Windows</h4>
<div class="outline-text-4" id="text-1-3-13">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq tramp-default-method <span class="org-string">"plink"</span>)
(setq tramp-auto-save-directory <span class="org-string">"c:\\sacha\\tmp"</span>)
(getenv <span class="org-string">"PATH"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-3-14" class="outline-4">
<h4 id="sec-1-3-14">More keybindings! More! More!</h4>
<div class="outline-text-4" id="text-1-3-14">
<p>
I'm on Windows, so I can use AutoHotkey to remind some of the keys
that I don't use that often. For example, the forward and back
buttons on my Thinkpad&#x2026;
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(global-set-key '[f15] 'execute-extended-command)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4">Writing</h3>
<div class="outline-text-3" id="text-1-4">
</div><div id="outline-container-sec-1-4-1" class="outline-4">
<h4 id="sec-1-4-1">Avoiding weasel words</h4>
<div class="outline-text-4" id="text-1-4-1">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">artbollocks-mode</span>
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">progn</span>
    (setq artbollocks-weasel-words-regex
          (concat <span class="org-string">"\\b"</span> (regexp-opt
                         '(<span class="org-string">"one of the"</span>
                           <span class="org-string">"should"</span>
                           <span class="org-string">"just"</span>
                           <span class="org-string">"sort of"</span>
                           <span class="org-string">"a lot"</span>
                           <span class="org-string">"probably"</span>
                           <span class="org-string">"maybe"</span>
                           <span class="org-string">"perhaps"</span>
                           <span class="org-string">"I think"</span>
                           <span class="org-string">"really"</span>
                           <span class="org-string">"pretty"</span>
                           <span class="org-string">"nice"</span>
                           <span class="org-string">"action"</span>
                           <span class="org-string">"utilize"</span>
                           <span class="org-string">"leverage"</span>) t) <span class="org-string">"\\b"</span>))
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Don't show the art critic words, or at least until I figure</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">out my own jargon</span>
    (setq artbollocks-jargon nil)))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-4-2" class="outline-4">
<h4 id="sec-1-4-2">Unfill paragraph</h4>
<div class="outline-text-4" id="text-1-4-2">
<p>
From <a href="https://raw.github.com/qdot/conf_emacs/master/emacs_conf.org">https://raw.github.com/qdot/conf_emacs/master/emacs_conf.org</a>
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">unfill-paragraph</span> ()
  <span class="org-doc">"Takes a multi-line paragraph and makes it into a single line of text."</span>
  (interactive)
  (<span class="org-keyword">let</span> ((fill-column (point-max)))
    (fill-paragraph nil)))
</pre>
</div>

<p>
Also, <code>visual-line-mode</code> is so much better than <code>auto-fill-mode</code>.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(remove-hook 'text-mode-hook #'turn-on-auto-fill)
(add-hook 'text-mode-hook 'turn-on-visual-line-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-4-3" class="outline-4">
<h4 id="sec-1-4-3">Dictionary</h4>
<div class="outline-text-4" id="text-1-4-3">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(add-to-list 'load-path <span class="org-string">"~/elisp/dictionary-el"</span>)
(load-library <span class="org-string">"dictionary-init"</span>)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5">Org</h3>
<div class="outline-text-3" id="text-1-5">
<p>
I use <a href="http://www.orgmode.org/">Org Mode</a> to take notes, publish my blog, and do all sorts of
stuff.
</p>
</div>

<div id="outline-container-sec-1-5-1" class="outline-4">
<h4 id="sec-1-5-1">Modules</h4>
<div class="outline-text-4" id="text-1-5-1">
<p>
Org has a whole bunch of optional modules. These are the ones I'm
currently experimenting with.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">  (setq org-modules '(org-bbdb 
                      org-gnus
                      org-drill
                      org-info
                      org-jsinfo
                      org-habit
                      org-irc
                      org-mouse
                      org-annotate-file
                      org-eval
                      org-expiry
                      org-interactive-query
                      org-man
                      org-panel
                      org-screen
                      org-toc))
(setq org-expiry-inactive-timestamps t)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-2" class="outline-4">
<h4 id="sec-1-5-2">Keyboard shortcuts</h4>
<div class="outline-text-4" id="text-1-5-2">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(bind-key <span class="org-string">"C-c r"</span> 'org-capture)
(bind-key <span class="org-string">"C-c a"</span> 'org-agenda)
(bind-key <span class="org-string">"C-c l"</span> 'org-store-link)
(bind-key <span class="org-string">"C-c L"</span> 'org-insert-link-global)
(bind-key <span class="org-string">"C-c O"</span> 'org-open-at-point-global)
(bind-key <span class="org-string">"&lt;f9&gt; &lt;f9&gt;"</span> 'org-agenda-list)
(bind-key <span class="org-string">"&lt;f9&gt; &lt;f8&gt;"</span> (<span class="org-keyword">lambda</span> () (interactive) (org-capture nil <span class="org-string">"r"</span>)))
(<span class="org-keyword">eval-after-load</span> 'org
  '(<span class="org-keyword">progn</span>
     (bind-key <span class="org-string">"C-TAB"</span> 'org-cycle org-mode-map)
     (bind-key <span class="org-string">"C-c v"</span> 'org-show-todo-tree org-mode-map)
     (bind-key <span class="org-string">"C-c C-r"</span> 'org-refile org-mode-map)
     (bind-key <span class="org-string">"C-c R"</span> 'org-reveal org-mode-map)))
</pre>
</div>

<p>
<code>append-next-kill</code> is more useful to me than <code>org-table-copy-region</code>.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">eval-after-load</span> 'org
  '(<span class="org-keyword">progn</span>
     (bind-key <span class="org-string">"C-M-w"</span> 'append-next-kill org-mode-map)))
</pre>
</div>

<p>
I don't use the diary, but I do use the clock a lot.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">org-agenda</span>
  <span class="org-builtin">:init</span> (bind-key <span class="org-string">"i"</span> 'org-agenda-clock-in org-agenda-mode-map))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-3" class="outline-4">
<h4 id="sec-1-5-3">Navigation</h4>
<div class="outline-text-4" id="text-1-5-3">
<p>
From <a href="http://stackoverflow.com/questions/15011703/is-there-an-emacs-org-mode-command-to-jump-to-an-org-heading">http://stackoverflow.com/questions/15011703/is-there-an-emacs-org-mode-command-to-jump-to-an-org-heading</a>
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">  (setq org-goto-interface 'outline
        org-goto-max-level 10)
  (<span class="org-keyword">require</span> '<span class="org-constant">imenu</span>)
  (global-set-key (kbd <span class="org-string">"M-o"</span>) 'imenu)
(global-set-key (kbd <span class="org-string">"C-c j"</span>) 'org-clock-goto)
(global-set-key (kbd <span class="org-string">"C-c i"</span>) (<span class="org-keyword">lambda</span> () (interactive) (find-file <span class="org-string">"~/Dropbox/public/sharing/index.org"</span>)))
(setq org-cycle-include-plain-lists 'integrate)
</pre>
</div>

<p>
This makes it easier for me to link trees with entries, as in <a href="http://sachachua.com/evil-plans">http://sachachua.com/evil-plans</a>
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-follow-entry-link</span> ()
  <span class="org-doc">"Follow the defined link for this entry."</span>
  (interactive)
  (<span class="org-keyword">if</span> (org-entry-get (point) <span class="org-string">"LINK"</span>)
      (org-open-link-from-string (org-entry-get (point) <span class="org-string">"LINK"</span>))
    (org-open-at-point)))

(bind-key <span class="org-string">"C-c o"</span> 'sacha/org-follow-entry-link org-mode-map)

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-link-projects</span> (location)
  <span class="org-doc">"Add link properties between the current subtree and the one specified by LOCATION."</span>
  (interactive
   (list (<span class="org-keyword">let</span> ((org-refile-use-cache nil))
     (org-refile-get-location <span class="org-string">"Location"</span>))))
  (<span class="org-keyword">let</span> ((link1 (org-store-link nil)) link2)
    (<span class="org-keyword">save-window-excursion</span>
      (org-refile 4 nil location)
      (setq link2 (org-store-link nil))
      (org-set-property <span class="org-string">"LINK"</span> link1))
    (org-set-property <span class="org-string">"LINK"</span> link2)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-4" class="outline-4">
<h4 id="sec-1-5-4">Taking notes</h4>
<div class="outline-text-4" id="text-1-5-4">
<p>
My org files are in my <code>personal</code> directory, which is actually a
symlink to a directory in my Dropbox. That way, I can update my
Org files from multiple computers.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-directory <span class="org-string">"~/personal"</span>)
(setq org-default-notes-file <span class="org-string">"~/personal/organizer.org"</span>)
</pre>
</div>

<p>
This makes it easier to add links from outside.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/yank-more</span> ()
  (interactive)
  (insert <span class="org-string">"[["</span>)
  (yank)
  (insert <span class="org-string">"][more]]"</span>))
(global-set-key (kbd <span class="org-string">"&lt;f6&gt;"</span>) 'sacha/yank-more)
</pre>
</div>

<p>
Indenting list items by 4 spaces instead of 2 makes them easier to
pop into <a href="http://draftin.com/">Draft</a>, which uses Markdown.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-list-indent-offset 2)
</pre>
</div>
</div>
<div id="outline-container-sec-1-5-4-1" class="outline-5">
<h5 id="sec-1-5-4-1">Templates</h5>
<div class="outline-text-5" id="text-1-5-4-1">
<p>
I use <code>org-capture</code> templates to quickly jot down tasks, ledger
entries, notes, and other semi-structured pieces of information.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-capture-templates
      '((<span class="org-string">"t"</span> <span class="org-string">"Tasks"</span> entry 
         (file+headline <span class="org-string">"~/personal/organizer.org"</span> <span class="org-string">"Tasks"</span>)
         <span class="org-string">"* TODO %^{Task}    </span>
<span class="org-string">SCHEDULED: %^t</span>
<span class="org-string">%?</span>
<span class="org-string">:PROPERTIES:</span>
<span class="org-string">:Effort: %^{effort|1:00|0:05|0:15|0:30|2:00|4:00}</span>
<span class="org-string">:END:"</span>)
        (<span class="org-string">"b"</span> <span class="org-string">"Business task"</span> entry
         (file+headline <span class="org-string">"~/personal/business.org"</span> <span class="org-string">"Tasks"</span>)
         <span class="org-string">"* TODO %^{Task}</span>
<span class="org-string">SCHEDULED: %^t</span>
<span class="org-string">%?</span>
<span class="org-string">:PROPERTIES:</span>
<span class="org-string">:Effort: %^{effort|1:00|0:05|0:15|0:30|2:00|4:00}</span>
<span class="org-string">:END:"</span>)
        (<span class="org-string">"p"</span> <span class="org-string">"People task"</span> entry
         (file+headline <span class="org-string">"~/personal/people.org"</span> <span class="org-string">"Tasks"</span>)
         <span class="org-string">"* TODO %^{Task}</span>
<span class="org-string">SCHEDULED: %^t</span>
<span class="org-string">%?</span>
<span class="org-string">:PROPERTIES:</span>
<span class="org-string">:Effort: %^{effort|1:00|0:05|0:15|0:30|2:00|4:00}</span>
<span class="org-string">:END:"</span>)
        (<span class="org-string">"db"</span> <span class="org-string">"Done - Business"</span> entry
         (file+headline <span class="org-string">"~/personal/business.org"</span> <span class="org-string">"Tasks"</span>)
         <span class="org-string">"* DONE %^{Task}\nSCHEDULED: %^t\n%?"</span>)
        (<span class="org-string">"dp"</span> <span class="org-string">"Done - People"</span> entry
         (file+headline <span class="org-string">"~/personal/people.org"</span> <span class="org-string">"Tasks"</span>)
         <span class="org-string">"* DONE %^{Task}\nSCHEDULED: %^t\n%?"</span>)
        (<span class="org-string">"dt"</span> <span class="org-string">"Done - Task"</span> entry
         (file+headline <span class="org-string">"~/personal/organizer.org"</span> <span class="org-string">"Tasks"</span>)
         <span class="org-string">"* DONE %^{Task}\nSCHEDULED: %^t\n%?"</span>)
        (<span class="org-string">"q"</span> <span class="org-string">"Quick note"</span> item
         (file+headline <span class="org-string">"~/personal/organizer.org"</span> <span class="org-string">"Quick notes"</span>))
        (<span class="org-string">"l"</span> <span class="org-string">"Ledger entries"</span>)
        (<span class="org-string">"lm"</span> <span class="org-string">"MBNA"</span> plain
         (file <span class="org-string">"~/personal/ledger"</span>)
         <span class="org-string">"%(org-read-date) %^{Payee}</span>
<span class="org-string">  Liabilities:MBNA  </span>
<span class="org-string">  Expenses:%^{Account}  $%^{Amount}</span>
<span class="org-string">"</span> <span class="org-builtin">:immediate-finish</span>)
        (<span class="org-string">"ln"</span> <span class="org-string">"No Frills"</span> plain
         (file <span class="org-string">"~/personal/ledger"</span>)
         <span class="org-string">"%(let ((org-read-date-prefer-future nil)) (org-read-date)) * No Frills</span>
<span class="org-string">  Liabilities:MBNA  </span>
<span class="org-string">  Assets:Wayne:Groceries  $%^{Amount}</span>
<span class="org-string">"</span> <span class="org-builtin">:immediate-finish</span>)    
        (<span class="org-string">"lc"</span> <span class="org-string">"Cash"</span> plain
         (file <span class="org-string">"~/personal/ledger"</span>)
         <span class="org-string">"%(org-read-date) * %^{Payee}</span>
<span class="org-string">  Expenses:Cash </span>
<span class="org-string">  Expenses:%^{Account}  %^{Amount}</span>
<span class="org-string">"</span>)             
        (<span class="org-string">"b"</span> <span class="org-string">"Book"</span> entry
         (file+datetree <span class="org-string">"~/personal/books.org"</span> <span class="org-string">"Inbox"</span>)
         <span class="org-string">"* %^{Title}  %^g</span>
<span class="org-string">%i</span>
<span class="org-string">*Author(s):* %^{Author} \\\\</span>
<span class="org-string">*ISBN:* %^{ISBN}</span>

<span class="org-string">%?</span>

<span class="org-string">*Review on:* %^t \\</span>
<span class="org-string">%a</span>
<span class="org-string">%U"</span>
         <span class="org-builtin">:clock-in</span> <span class="org-builtin">:clock-resume</span>)
         (<span class="org-string">"c"</span> <span class="org-string">"Contact"</span> entry (file <span class="org-string">"~/personal/contacts.org"</span>)
          <span class="org-string">"* %(org-contacts-template-name)</span>
<span class="org-string">:PROPERTIES:</span>
<span class="org-string">:EMAIL: %(org-contacts-template-email)</span>
<span class="org-string">:END:"</span>)
         (<span class="org-string">"n"</span> <span class="org-string">"Daily note"</span> table-line (file+olp <span class="org-string">"~/personal/organizer.org"</span> <span class="org-string">"Daily notes"</span>)
          <span class="org-string">"| %u | %^{Note} |"</span>
          <span class="org-builtin">:immediate-finish</span>)
         (<span class="org-string">"r"</span> <span class="org-string">"Notes"</span> entry
          (file+datetree <span class="org-string">"~/personal/organizer.org"</span>)
          <span class="org-string">"* %?\n\n%i\n"</span>
          )))
(global-set-key (kbd <span class="org-string">"C-M-r"</span>) 'org-capture)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-4-2" class="outline-5">
<h5 id="sec-1-5-4-2">Refiling</h5>
<div class="outline-text-5" id="text-1-5-4-2">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-reverse-note-order t)
(setq org-refile-use-outline-path nil)
(setq org-refile-allow-creating-parent-nodes 'confirm)
(setq org-refile-use-cache t)
(setq org-refile-targets
      '((<span class="org-string">"~/personal/business.org"</span> . (<span class="org-builtin">:maxlevel</span> . 4))
        (<span class="org-string">"~/personal/organizer.org"</span> . (<span class="org-builtin">:maxlevel</span> . 4))
        (<span class="org-string">"~/personal/people.org"</span> . (<span class="org-builtin">:maxlevel</span> . 3))
        (<span class="org-string">"~/personal/outline.org"</span> . (<span class="org-builtin">:maxlevel</span> . 3))
        (<span class="org-string">"~/personal/routines.org"</span> . (<span class="org-builtin">:maxlevel</span> . 4))))
(setq org-blank-before-new-entry nil)
<span class="org-comment-delimiter">;</span><span class="org-comment">(defun sacha/verify-refile-target ()</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">"Exclude todo keywords with a DONE state from refile targets"</span>
<span class="org-comment-delimiter">;  </span><span class="org-comment">(not (member (nth 2 (org-heading-components)) org-done-keywords)))</span>
<span class="org-comment-delimiter">;</span><span class="org-comment">(setq org-refile-target-verify-function 'sacha/verify-refile-target)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-4-3" class="outline-5">
<h5 id="sec-1-5-4-3">Estimating WPM</h5>
<div class="outline-text-5" id="text-1-5-4-3">
<p>
I'm curious about how fast I type some things.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">org-clock</span>)
(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-entry-wpm</span> ()
  (interactive)
  (<span class="org-keyword">save-restriction</span>
    (<span class="org-keyword">save-excursion</span>
      (org-narrow-to-subtree)
      (goto-char (point-min))
      (<span class="org-keyword">let*</span> ((words (count-words-region (point-min) (point-max)))
             (minutes (org-clock-sum-current-item))
             (wpm (/ words minutes)))
        (message <span class="org-string">"WPM: %d (words: %d, minutes: %d)"</span> wpm words minutes)
        (kill-new (number-to-string wpm))))))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-5" class="outline-4">
<h4 id="sec-1-5-5">Managing tasks</h4>
<div class="outline-text-4" id="text-1-5-5">
</div><div id="outline-container-sec-1-5-5-1" class="outline-5">
<h5 id="sec-1-5-5-1">Track TODO state</h5>
<div class="outline-text-5" id="text-1-5-5-1">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-todo-keywords
 '((sequence
    <span class="org-string">"TODO(t)"</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">next action</span>
    <span class="org-string">"TOBLOG(b)"</span>  <span class="org-comment-delimiter">; </span><span class="org-comment">next action</span>
    <span class="org-string">"STARTED(s)"</span>
    <span class="org-string">"WAITING(w@/!)"</span>
    <span class="org-string">"POSTPONED(p)"</span> <span class="org-string">"SOMEDAY(s@/!)"</span> <span class="org-string">"|"</span> <span class="org-string">"DONE(x!)"</span> <span class="org-string">"CANCELLED(c@)"</span>)
   (sequence <span class="org-string">"TODELEGATE(-)"</span> <span class="org-string">"DELEGATED(d)"</span> <span class="org-string">"COMPLETE(x)"</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-5-2" class="outline-5">
<h5 id="sec-1-5-5-2">Strike through DONE headlines</h5>
<div class="outline-text-5" id="text-1-5-5-2">
<p>
I wanted a quick way to visually distinguish DONE tasks from tasks I
still need to do. This <a href="http://lists.gnu.org/archive/html/emacs-orgmode/2007-03/msg00179.html">handy snippet from the Emacs Org-mode mailing list</a> does the trick by striking through the headlines for DONE tasks.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-fontify-done-headline t)
(custom-set-faces
 '(org-done ((t (<span class="org-builtin">:foreground</span> <span class="org-string">"PaleGreen"</span>   
                 <span class="org-builtin">:weight</span> normal
                 <span class="org-builtin">:strike-through</span> t))))
 '(org-headline-done 
            ((((class color) (min-colors 16) (background dark)) 
               (<span class="org-builtin">:foreground</span> <span class="org-string">"LightSalmon"</span> <span class="org-builtin">:strike-through</span> t)))))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-5-3" class="outline-5">
<h5 id="sec-1-5-5-3">Projects</h5>
<div class="outline-text-5" id="text-1-5-5-3">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-tags-exclude-from-inheritance '(<span class="org-string">"PROJECT"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-5-4" class="outline-5">
<h5 id="sec-1-5-5-4">Tag tasks</h5>
<div class="outline-text-5" id="text-1-5-5-4">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-tag-alist '((<span class="org-string">"@work"</span> . ?b) 
                      (<span class="org-string">"@home"</span> . ?h) 
                      (<span class="org-string">"@writing"</span> . ?w)
                      (<span class="org-string">"@errands"</span> . ?e) 
                      (<span class="org-string">"@drawing"</span> . ?d)
                      (<span class="org-string">"@coding"</span> . ?c)
                      (<span class="org-string">"@phone"</span> . ?p)
                      (<span class="org-string">"@reading"</span> . ?r)
                      (<span class="org-string">"@computer"</span> . ?l)
                      (<span class="org-string">"quantified"</span> . ?q)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-5-5" class="outline-5">
<h5 id="sec-1-5-5-5">Enable filtering by effort estimates</h5>
<div class="outline-text-5" id="text-1-5-5-5">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-global-properties
      '((<span class="org-string">"Effort_ALL"</span>. <span class="org-string">"0:05 0:15 0:30 1:00 2:00 3:00 4:00"</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-5-6" class="outline-5">
<h5 id="sec-1-5-5-6">Track time</h5>
<div class="outline-text-5" id="text-1-5-5-6">
<div class="org-src-container">

<pre class="src src-emacs-lisp">   (setq org-clock-idle-time nil)
   (setq org-log-done 'time)
   (<span class="org-keyword">defadvice</span> <span class="org-function-name">org-clock-in</span> (after wicked activate)
<span class="org-doc">"Mark STARTED when clocked in"</span>
(<span class="org-keyword">save-excursion</span>
  (<span class="org-keyword">catch</span> '<span class="org-constant">exit</span>
    (org-back-to-heading t)
    (<span class="org-keyword">if</span> (looking-at org-outline-regexp) (goto-char (1- (match-end 0))))
    (<span class="org-keyword">if</span> (looking-at (concat <span class="org-string">" +"</span> org-todo-regexp <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string"> +</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">[ \t]*$</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>))
        (org-todo <span class="org-string">"STARTED"</span>)))))
</pre>
</div>
<p>
(setq org-clock-idle-time nil)
</p>
</div>
</div>
<div id="outline-container-sec-1-5-5-7" class="outline-5">
<h5 id="sec-1-5-5-7">Habits</h5>
<div class="outline-text-5" id="text-1-5-5-7">
<p>
I like using org-habits to track consistency. My task names tend
to be a bit long, though, so I've configured the graph column to
show a little bit more to the right.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">     (setq org-habit-graph-column 80)
(setq org-habit-show-habits-only-for-today nil)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-6" class="outline-4">
<h4 id="sec-1-5-6">Estimating tasks</h4>
<div class="outline-text-4" id="text-1-5-6">
<p>
From "Add an effort estimate on the fly when clocking in" on the
<a href="http://orgmode.org/worg/org-hacks.html">Org Hacks</a> page:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(add-hook 'org-clock-in-prepare-hook
          'my-org-mode-ask-effort)

(<span class="org-keyword">defun</span> <span class="org-function-name">my-org-mode-ask-effort</span> ()
  <span class="org-doc">"Ask for an effort estimate when clocking in."</span>
  (<span class="org-keyword">unless</span> (org-entry-get (point) <span class="org-string">"Effort"</span>)
    (<span class="org-keyword">let</span> ((effort
           (completing-read
            <span class="org-string">"Effort: "</span>
            (org-entry-get-multivalued-property (point) <span class="org-string">"Effort"</span>))))
      (<span class="org-keyword">unless</span> (equal effort <span class="org-string">""</span>)
        (org-set-property <span class="org-string">"Effort"</span> effort)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-7" class="outline-4">
<h4 id="sec-1-5-7">Modifying org agenda so that I can display a subset of tasks</h4>
<div class="outline-text-4" id="text-1-5-7">
<p>
I want to create an agenda command that displays a list of tasks by
context. That way, I can quickly preview a bunch of contexts and
decide what I feel like doing the most.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">sacha/org-agenda-limit-items</span> nil <span class="org-doc">"Number of items to show in agenda to-do views; nil if unlimited."</span>)
(<span class="org-keyword">defadvice</span> <span class="org-function-name">org-agenda-finalize-entries</span> (around sacha activate)
  (<span class="org-keyword">if</span> sacha/org-agenda-limit-items
      (<span class="org-keyword">progn</span>
        (setq list (mapcar 'org-agenda-highlight-todo list))
        (<span class="org-keyword">if</span> nosort
          (setq ad-return-value
            (subseq list 0 sacha/org-agenda-limit-items))
          (<span class="org-keyword">when</span> org-agenda-before-sorting-filter-function
            (setq list (delq nil (mapcar org-agenda-before-sorting-filter-function list))))
          (setq ad-return-value
                (mapconcat 'identity
                           (delq nil 
                                 (subseq
                                  (sort list 'org-entries-lessp)
                                  0
                                  sacha/org-agenda-limit-items))
                           <span class="org-string">"\n"</span>))))
    ad-do-it))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-8" class="outline-4">
<h4 id="sec-1-5-8">Fixing relative dates</h4>
<div class="outline-text-4" id="text-1-5-8">
<p>
If today is Friday, I want +fri to be <span class="underline">next</span> Friday. I submitted a
patch for this, but I'm not on the git version yet.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">org-read-date-get-relative</span> (s today default)
  <span class="org-doc">"Check string S for special relative date string.</span>
<span class="org-doc">TODAY and DEFAULT are internal times, for today and for a default.</span>
<span class="org-doc">Return shift list (N what def-flag)</span>
<span class="org-doc">WHAT       is \"d\", \"w\", \"m\", or \"y\" for day, week, month, year.</span>
<span class="org-doc">N          is the number of WHATs to shift.</span>
<span class="org-doc">DEF-FLAG   is t when a double ++ or -- indicates shift relative to</span>
<span class="org-doc">           the DEFAULT date rather than TODAY."</span>
  (<span class="org-keyword">require</span> '<span class="org-constant">parse-time</span>)
  (<span class="org-keyword">when</span> (and
         (string-match
          (concat
           <span class="org-string">"\\`[ \t]*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[-+]\\{0,2\\}</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>
           <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?"</span>
           <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[hdwmy]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">"</span> (mapconcat 'car parse-time-weekdays <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">"</span>) <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?"</span>
           <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[ \t]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">$</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>) s)
         (or (&gt; (match-end 1) (match-beginning 1)) (match-end 4)))
    (<span class="org-keyword">let*</span> ((dir (<span class="org-keyword">if</span> (&gt; (match-end 1) (match-beginning 1))
                    (string-to-char (substring (match-string 1 s) -1))
                  ?+))
           (rel (and (match-end 1) (= 2 (- (match-end 1) (match-beginning 1)))))
           (n (<span class="org-keyword">if</span> (match-end 2) (string-to-number (match-string 2 s)) 1))
           (what (<span class="org-keyword">if</span> (match-end 3) (match-string 3 s) <span class="org-string">"d"</span>))
           (wday1 (cdr (assoc (downcase what) parse-time-weekdays)))
           (date (<span class="org-keyword">if</span> rel default today))
           (wday (nth 6 (decode-time date)))
           delta)
      (<span class="org-keyword">if</span> wday1
          (<span class="org-keyword">progn</span>
            (setq delta (mod (+ 7 (- wday1 wday)) 7))
            (<span class="org-keyword">if</span> (= delta 0) (setq delta 7))
            (<span class="org-keyword">if</span> (= dir ?-)
                (<span class="org-keyword">progn</span>
                  (setq delta (- delta 7))
                  (<span class="org-keyword">if</span> (= delta 0) (setq delta -7))))
            (<span class="org-keyword">if</span> (&gt; n 1) (setq delta (+ delta (* (1- n) (<span class="org-keyword">if</span> (= dir ?-) -7 7)))))
            (list delta <span class="org-string">"d"</span> rel))
        (list (* n (<span class="org-keyword">if</span> (= dir ?-) -1 1)) what rel)))))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-9" class="outline-4">
<h4 id="sec-1-5-9">Flexible scheduling of tasks</h4>
<div class="outline-text-4" id="text-1-5-9">
<p>
I want to be able to schedule tasks for dates like the first Saturday
of every month. Fortunately, <a href="http://stackoverflow.com/questions/13555385/org-mode-how-to-schedule-repeating-tasks-for-the-first-saturday-of-every-month">someone else has figured that out!</a>
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">Get this from https://raw.github.com/chenfengyuan/elisp/master/next-spec-day.el</span>
(load-file <span class="org-string">"~/elisp/next-spec-day.el"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-10" class="outline-4">
<h4 id="sec-1-5-10">Org agenda</h4>
<div class="outline-text-4" id="text-1-5-10">
</div><div id="outline-container-sec-1-5-10-1" class="outline-5">
<h5 id="sec-1-5-10-1">Basic configuration</h5>
<div class="outline-text-5" id="text-1-5-10-1">
<p>
I have quite a few Org files, but I keep my agenda items and TODOs in
only a few of them them for faster scanning.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-agenda-files '(<span class="org-string">"~/personal/organizer.org"</span>
                         <span class="org-string">"~/personal/people.org"</span>
                         <span class="org-string">"~/personal/business.org"</span>
                         <span class="org-string">"~/personal/routines.org"</span>))
</pre>
</div>

<p>
I like looking at two days at a time when I plan using the Org
agenda. I want to see my log entries, but I don't want to see
scheduled items that I've finished. I like seeing a time grid so that
I can get a sense of how appointments are spread out.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-agenda-span 2)
(setq org-agenda-sticky nil)
(setq org-agenda-show-log t)
(setq org-agenda-skip-scheduled-if-done t)
(setq org-agenda-skip-deadline-if-done t)
(setq org-agenda-time-grid
      '((daily today require-timed)
       <span class="org-string">"----------------"</span>
       (800 1000 1200 1400 1600 1800)))
(setq org-columns-default-format <span class="org-string">"%50ITEM %12SCHEDULED %TODO %3PRIORITY %Effort{:} %TAGS"</span>)
</pre>
</div>

<p>
Some other keyboard shortcuts:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(define-key org-agenda-mode-map <span class="org-string">"Y"</span> 'org-agenda-todo-yesterday)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-10-2" class="outline-5">
<h5 id="sec-1-5-10-2">Display projects with associated subtasks</h5>
<div class="outline-text-5" id="text-1-5-10-2">
<p>
I wanted a view that showed projects with a few subtasks underneath
them. Here's a sample of the output:
</p>

<pre class="example">
Headlines with TAGS match: +PROJECT
Press `C-u r' to search again with new search string
  organizer:  Set up communication processes for Awesome Foundation Toronto
  organizer:  TODO Announce the next pitch night
  organizer:  TODO Follow up with the winner of the previous pitch night for any news to include in the updates

  organizer:  Tidy up the house so that I can find things quickly
  organizer:  TODO Inventory all the things in closets and boxes         :@home:
  organizer:  TODO Drop things off for donation                       :@errands:

  organizer:  Learn how to develop for Android devices
</pre>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-agenda-project-agenda</span> ()
  <span class="org-doc">"Return the project headline and up to `</span><span class="org-doc"><span class="org-constant">sacha/org-agenda-limit-items</span></span><span class="org-doc">' tasks."</span>
  (<span class="org-keyword">save-excursion</span>
    (<span class="org-keyword">let*</span> ((marker (org-agenda-new-marker))
           (heading
            (org-agenda-format-item <span class="org-string">""</span> (org-get-heading) (org-get-category) nil))
           (org-agenda-restrict t)
           (org-agenda-restrict-begin (point))
           (org-agenda-restrict-end (org-end-of-subtree 'invisible))
           <span class="org-comment-delimiter">;; </span><span class="org-comment">Find the TODO items in this subtree</span>
           (list (org-agenda-get-day-entries (buffer-file-name) (calendar-current-date) <span class="org-builtin">:todo</span>)))
      (org-add-props heading
          (list 'face 'defaults
                'done-face 'org-agenda-done
                'undone-face 'default
                'mouse-face 'highlight
                'org-not-done-regexp org-not-done-regexp
                'org-todo-regexp org-todo-regexp
                'org-complex-heading-regexp org-complex-heading-regexp
                'help-echo
                (format <span class="org-string">"mouse-2 or RET jump to org file %s"</span>
                        (abbreviate-file-name
                         (or (buffer-file-name (buffer-base-buffer))
                             (buffer-name (buffer-base-buffer))))))
        'org-marker marker
        'org-hd-marker marker
        'org-category (org-get-category)
        'type <span class="org-string">"tagsmatch"</span>)
      (concat heading <span class="org-string">"\n"</span>
              (org-agenda-finalize-entries list)))))

  (<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-agenda-projects-and-tasks</span> (match)
    <span class="org-doc">"Show TODOs for all `</span><span class="org-doc"><span class="org-constant">org-agenda-files</span></span><span class="org-doc">' headlines matching MATCH."</span>
    (interactive <span class="org-string">"MString: "</span>)
    (<span class="org-keyword">let</span> ((todo-only nil))
      (<span class="org-keyword">if</span> org-agenda-overriding-arguments
          (setq todo-only (car org-agenda-overriding-arguments)
                match (nth 1 org-agenda-overriding-arguments)))
      (<span class="org-keyword">let*</span> ((org-tags-match-list-sublevels
              org-tags-match-list-sublevels)
             (completion-ignore-case t)
             rtn rtnall files file pos matcher
             buffer)
        (<span class="org-keyword">when</span> (and (stringp match) (not (string-match <span class="org-string">"\\S-"</span> match)))
          (setq match nil))
        (setq matcher (org-make-tags-matcher match)
              match (car matcher) matcher (cdr matcher))
        (<span class="org-keyword">catch</span> '<span class="org-constant">exit</span>
          (<span class="org-keyword">if</span> org-agenda-sticky
              (setq org-agenda-buffer-name
                    (<span class="org-keyword">if</span> (stringp match)
                        (format <span class="org-string">"*Org Agenda(%s:%s)*"</span>
                                (or org-keys (or (and todo-only <span class="org-string">"M"</span>) <span class="org-string">"m"</span>)) match)
                      (format <span class="org-string">"*Org Agenda(%s)*"</span> (or (and todo-only <span class="org-string">"M"</span>) <span class="org-string">"m"</span>)))))
          (org-agenda-prepare (concat <span class="org-string">"TAGS "</span> match))
          (org-compile-prefix-format 'tags)
          (org-set-sorting-strategy 'tags)
          (setq org-agenda-query-string match)
          (setq org-agenda-redo-command
                (list 'org-tags-view `(quote ,todo-only)
                      (list 'if 'current-prefix-arg nil `(quote ,org-agenda-query-string))))
          (setq files (org-agenda-files nil 'ifmode)
                rtnall nil)
          (<span class="org-keyword">while</span> (setq file (pop files))
            (<span class="org-keyword">catch</span> '<span class="org-constant">nextfile</span>
              (org-check-agenda-file file)
              (setq buffer (<span class="org-keyword">if</span> (file-exists-p file)
                               (org-get-agenda-file-buffer file)
                             (<span class="org-warning">error</span> <span class="org-string">"No such file %s"</span> file)))
              (<span class="org-keyword">if</span> (not buffer)
                  <span class="org-comment-delimiter">;; </span><span class="org-comment">If file does not exist, error message to agenda</span>
                  (setq rtn (list
                             (format <span class="org-string">"ORG-AGENDA-ERROR: No such org-file %s"</span> file))
                        rtnall (append rtnall rtn))
                (<span class="org-keyword">with-current-buffer</span> buffer
                  (<span class="org-keyword">unless</span> (derived-mode-p 'org-mode)
                    (<span class="org-warning">error</span> <span class="org-string">"Agenda file %s is not in `</span><span class="org-string"><span class="org-constant">org-mode</span></span><span class="org-string">'"</span> file))
                  (<span class="org-keyword">save-excursion</span>
                    (<span class="org-keyword">save-restriction</span>
                      (<span class="org-keyword">if</span> org-agenda-restrict
                          (narrow-to-region org-agenda-restrict-begin
                                            org-agenda-restrict-end)
                        (widen))
                      (setq rtn (org-scan-tags 'sacha/org-agenda-project-agenda matcher todo-only))
                      (setq rtnall (append rtnall rtn))))))))
          (<span class="org-keyword">if</span> org-agenda-overriding-header
              (insert (org-add-props (copy-sequence org-agenda-overriding-header)
                          nil 'face 'org-agenda-structure) <span class="org-string">"\n"</span>)
            (insert <span class="org-string">"Headlines with TAGS match: "</span>)
            (add-text-properties (point-min) (1- (point))
                                 (list 'face 'org-agenda-structure
                                       'short-heading
                                       (concat <span class="org-string">"Match: "</span> match)))
            (setq pos (point))
            (insert match <span class="org-string">"\n"</span>)
            (add-text-properties pos (1- (point)) (list 'face 'org-warning))
            (setq pos (point))
            (<span class="org-keyword">unless</span> org-agenda-multi
              (insert <span class="org-string">"Press `C-u r' to search again with new search string\n"</span>))
            (add-text-properties pos (1- (point)) (list 'face 'org-agenda-structure)))
          (org-agenda-mark-header-line (point-min))
          (<span class="org-keyword">when</span> rtnall
            (insert (mapconcat 'identity rtnall <span class="org-string">"\n"</span>) <span class="org-string">""</span>))
          (goto-char (point-min))
          (or org-agenda-multi (org-agenda-fit-window-to-buffer))
          (add-text-properties (point-min) (point-max)
                               `(org-agenda-type tags
                                                 org-last-args (,todo-only ,match)
                                                 org-redo-cmd ,org-agenda-redo-command
                                                 org-series-cmd ,org-cmd))
          (org-agenda-finalize)
          (setq buffer-read-only t)))))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-10-3" class="outline-5">
<h5 id="sec-1-5-10-3">Org agenda custom commands</h5>
<div class="outline-text-5" id="text-1-5-10-3">
<p>
There are quite a few custom commands here, and I often forget to use
them. =) But it's good to define them, and over time, I'll get the
hang of using these more!
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">Key</td>
<td class="left">Description</td>
</tr>

<tr>
<td class="left">w</td>
<td class="left">What am I waiting for?</td>
</tr>

<tr>
<td class="left">T</td>
<td class="left">Not really an agenda command - shows the to-do tree in the current file</td>
</tr>

<tr>
<td class="left">b</td>
<td class="left">Shows business-related tasks</td>
</tr>

<tr>
<td class="left">o</td>
<td class="left">Shows personal tasks and miscellaneous tasks (o: organizer)</td>
</tr>

<tr>
<td class="left">t</td>
<td class="left">Show all my to-dos</td>
</tr>

<tr>
<td class="left">w</td>
<td class="left">Show all tasks for the upcoming week</td>
</tr>

<tr>
<td class="left">g &#x2026;</td>
<td class="left">Show tasks by context: b - business; c - coding; w - writing; p - phone; d - drawing, h - home</td>
</tr>

<tr>
<td class="left">0</td>
<td class="left">Show common contexts with up to 3 tasks each, so that I can choose what I feel like working on</td>
</tr>

<tr>
<td class="left">) (shift-0)</td>
<td class="left">Show common contexts with all the tasks associated with them</td>
</tr>

<tr>
<td class="left">9</td>
<td class="left">Show common contexts with up to 3 unscheduled tasks each</td>
</tr>

<tr>
<td class="left">( (shift-9)</td>
<td class="left">Show common contexts with all the unscheduled tasks associated with them</td>
</tr>

<tr>
<td class="left">d</td>
<td class="left">Timeline for today (agenda, clock summary)</td>
</tr>

<tr>
<td class="left">u</td>
<td class="left">Unscheduled tasks to do if I have free time</td>
</tr>

<tr>
<td class="left">P</td>
<td class="left">Tasks by priority</td>
</tr>

<tr>
<td class="left">p</td>
<td class="left">My projects</td>
</tr>

<tr>
<td class="left">2</td>
<td class="left">Projects with tasks</td>
</tr>
</tbody>
</table>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">sacha/org-agenda-contexts</span>
  '((tags-todo <span class="org-string">"+@phone/!-SOMEDAY"</span>)
    (tags-todo <span class="org-string">"+@work/!-SOMEDAY"</span>)
    (tags-todo <span class="org-string">"+@drawing/!-SOMEDAY"</span>)
    (tags-todo <span class="org-string">"+@coding/!-SOMEDAY"</span>)
    (tags-todo <span class="org-string">"+@writing/!-SOMEDAY"</span>)
    (tags-todo <span class="org-string">"+@computer/!-SOMEDAY"</span>)
    (tags-todo <span class="org-string">"+@home/!-SOMEDAY"</span>)
    (tags-todo <span class="org-string">"+@errands/!-SOMEDAY"</span>))
  <span class="org-doc">"Usual list of contexts."</span>)
(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-agenda-skip-scheduled</span> ()
  (org-agenda-skip-entry-if 'scheduled 'deadline
                            'regexp <span class="org-string">"\n]+&gt;"</span>))
(setq org-agenda-custom-commands
      `((<span class="org-string">"T"</span> todo-tree <span class="org-string">"TODO"</span>)
        (<span class="org-string">"b"</span> todo <span class="org-string">""</span>
         ((org-agenda-files '(<span class="org-string">"~/personal/business.org"</span>))))
        (<span class="org-string">"o"</span> todo <span class="org-string">""</span>
         ((org-agenda-files '(<span class="org-string">"~/personal/organizer.org"</span>))))
        (<span class="org-string">"t"</span> todo <span class="org-string">""</span>
         ((org-agenda-prefix-format <span class="org-string">""</span>)
          (org-agenda-cmp-user-defined 'sacha/org-sort-agenda-items-todo)
          (org-agenda-view-columns-initially t)
          ))
        <span class="org-comment-delimiter">;; </span><span class="org-comment">Weekly review</span>
        (<span class="org-string">"w"</span> <span class="org-string">"Weekly review"</span> agenda <span class="org-string">""</span> ((org-agenda-span 7) (org-agenda-log-mode 1)))
        (<span class="org-string">"W"</span> <span class="org-string">"Weekly review sans routines"</span> agenda <span class="org-string">""</span> ((org-agenda-span 7) (org-agenda-log-mode 1) (org-agenda-files '(<span class="org-string">"~/personal/business.org"</span> <span class="org-string">"~/personal/organizer.org"</span> <span class="org-string">"~/personal/people.org"</span>))))
        (<span class="org-string">"2"</span> <span class="org-string">"Bi-weekly review"</span> agenda <span class="org-string">""</span> ((org-agenda-span 14) (org-agenda-log-mode 1)))
        (<span class="org-string">"gb"</span> <span class="org-string">"Business"</span> todo <span class="org-string">""</span>  
         ((org-agenda-files '(<span class="org-string">"~/personal/business.org"</span>))
          (org-agenda-view-columns-initially t)))
        (<span class="org-string">"gc"</span> <span class="org-string">"Coding"</span> tags-todo <span class="org-string">"@coding"</span> 
         ((org-agenda-view-columns-initially t)))
        (<span class="org-string">"gw"</span> <span class="org-string">"Writing"</span> tags-todo <span class="org-string">"@writing"</span>
         ((org-agenda-view-columns-initially t)))
        (<span class="org-string">"gp"</span> <span class="org-string">"Phone"</span> tags-todo <span class="org-string">"@phone"</span>
         ((org-agenda-view-columns-initially t)))
        (<span class="org-string">"gd"</span> <span class="org-string">"Drawing"</span> tags-todo <span class="org-string">"@drawing"</span>
         ((org-agenda-view-columns-initially t)))
        (<span class="org-string">"gh"</span> <span class="org-string">"Home"</span> tags-todo <span class="org-string">"@home"</span>
         ((org-agenda-view-columns-initially t)))
        (<span class="org-string">"ge"</span> <span class="org-string">"Errands"</span> tags-todo <span class="org-string">"@errands"</span>
         ((org-agenda-view-columns-initially t)))
        (<span class="org-string">"0"</span> <span class="org-string">"Top 3 by context"</span>
         ,sacha/org-agenda-contexts
         ((org-agenda-sorting-strategy '(priority-up effort-down))
          (sacha/org-agenda-limit-items 3)))
        (<span class="org-string">")"</span> <span class="org-string">"All by context"</span>
         ,sacha/org-agenda-contexts
         ((org-agenda-sorting-strategy '(priority-down effort-down))
          (sacha/org-agenda-limit-items nil)))
        (<span class="org-string">"9"</span> <span class="org-string">"Unscheduled top 3 by context"</span>
         ,sacha/org-agenda-contexts
         ((org-agenda-skip-function 'sacha/org-agenda-skip-scheduled)
          (org-agenda-sorting-strategy '(priority-down effort-down))
          (sacha/org-agenda-limit-items 3)))
        (<span class="org-string">"("</span> <span class="org-string">"All unscheduled by context"</span>
         ,sacha/org-agenda-contexts
         ((org-agenda-skip-function 'sacha/org-agenda-skip-scheduled)
          (org-agenda-sorting-strategy '(priority-down effort-down))
          ))
        (<span class="org-string">"d"</span> <span class="org-string">"Timeline for today"</span> ((agenda <span class="org-string">""</span> ))
         ((org-agenda-ndays 1)
          (org-agenda-show-log t)
          (org-agenda-log-mode-items '(clock closed))
          (org-agenda-clockreport-mode t)
          (org-agenda-entry-types '())))
        (<span class="org-string">"w"</span> <span class="org-string">"Waiting for"</span> todo <span class="org-string">"WAITING"</span>)
        (<span class="org-string">"u"</span> <span class="org-string">"Unscheduled tasks"</span> alltodo <span class="org-string">""</span>
         ((org-agenda-skip-function 'sacha/org-agenda-skip-scheduled)
          (org-agenda-overriding-header <span class="org-string">"Unscheduled TODO entries: "</span>)))
        (<span class="org-string">"P"</span> <span class="org-string">"By priority"</span>
         ((tags-todo <span class="org-string">"+PRIORITY=\"A\""</span>)
          (tags-todo <span class="org-string">"+PRIORITY=\"B\""</span>)
          (tags-todo <span class="org-string">"+PRIORITY=\"\""</span>)
          (tags-todo <span class="org-string">"+PRIORITY=\"C\""</span>))
         ((org-agenda-prefix-format <span class="org-string">"%-10c %-10T %e "</span>)
          (org-agenda-sorting-strategy '(priority-down tag-up category-keep effort-down))))
        (<span class="org-string">"p"</span> tags <span class="org-string">"+PROJECT"</span>
         ((org-agenda-sorting-strategy '(priority-down tag-up category-keep effort-down))) )
        (<span class="org-string">"S"</span> tags-todo <span class="org-string">"TODO=\"STARTED\""</span>)
        (<span class="org-string">"2"</span> <span class="org-string">"List projects with tasks"</span> sacha/org-agenda-projects-and-tasks
         <span class="org-string">"+PROJECT"</span>
           ((sacha/org-agenda-limit-items 3)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-10-4" class="outline-5">
<h5 id="sec-1-5-10-4">Make it easy to mark a task as done</h5>
<div class="outline-text-5" id="text-1-5-10-4">
<p>
Great for quickly going through the to-do list. Gets rid of one
extra keystroke. ;)
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-agenda-done</span> (<span class="org-type">&amp;optional</span> arg)
  <span class="org-doc">"Mark current TODO as done.</span>
<span class="org-doc">This changes the line at point, all other lines in the agenda referring to</span>
<span class="org-doc">the same tree node, and the headline of the tree node in the Org-mode file."</span>
  (interactive <span class="org-string">"P"</span>)
  (org-agenda-todo <span class="org-string">"DONE"</span>))
<span class="org-comment-delimiter">;; </span><span class="org-comment">Override the key definition for org-exit</span>
(define-key org-agenda-mode-map <span class="org-string">"x"</span> 'sacha/org-agenda-done)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-10-5" class="outline-5">
<h5 id="sec-1-5-10-5">Make it easy to mark a task as done and create a follow-up task</h5>
<div class="outline-text-5" id="text-1-5-10-5">
<div class="org-src-container">

<pre class="src src-emacs-lisp">  (<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-agenda-mark-done-and-add-followup</span> ()
    <span class="org-doc">"Mark the current TODO as done and add another task after it.</span>
<span class="org-doc">Creates it at the same level as the previous task, so it's better to use</span>
<span class="org-doc">this with to-do items than with projects or headings."</span>
    (interactive)
    (org-agenda-todo <span class="org-string">"DONE"</span>)
    (org-agenda-switch-to)
    (org-capture 0 <span class="org-string">"t"</span>))
<span class="org-comment-delimiter">;; </span><span class="org-comment">Override the key definition</span>
(define-key org-agenda-mode-map <span class="org-string">"X"</span> 'sacha/org-agenda-mark-done-and-add-followup)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-10-6" class="outline-5">
<h5 id="sec-1-5-10-6">Capture something based on the agenda</h5>
<div class="outline-text-5" id="text-1-5-10-6">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-agenda-new</span> ()
  <span class="org-doc">"Create a new note or task at the current agenda item.</span>
<span class="org-doc">Creates it at the same level as the previous task, so it's better to use</span>
<span class="org-doc">this with to-do items than with projects or headings."</span>
  (interactive)
  (org-agenda-switch-to)
  (org-capture 0))
<span class="org-comment-delimiter">;; </span><span class="org-comment">New key assignment</span>
(define-key org-agenda-mode-map <span class="org-string">"N"</span> 'sacha/org-agenda-new)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-10-7" class="outline-5">
<h5 id="sec-1-5-10-7">Starting my weeks on Saturday</h5>
<div class="outline-text-5" id="text-1-5-10-7">
<p>
I like looking at weekends as <a href="http://sachachua.com/blog/2010/11/week-beginnings/">week beginnings</a> instead, so I want the
Org agenda to start on Saturdays.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-agenda-start-on-weekday 6)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-10-8" class="outline-5">
<h5 id="sec-1-5-10-8">Sorting by date and priority</h5>
<div class="outline-text-5" id="text-1-5-10-8">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-agenda-sorting-strategy
      '((agenda time-up category-keep priority-down tag-up effort-up)
        (todo user-defined-up todo-state-up priority-down effort-up)
        (tags user-defined-up)
        (search category-keep)))
(setq org-agenda-cmp-user-defined 'sacha/org-sort-agenda-items-user-defined)    
(<span class="org-keyword">require</span> '<span class="org-constant">cl</span>)
(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-get-context</span> (txt)
  <span class="org-doc">"Find the context."</span>
  (car (member-if
        (<span class="org-keyword">lambda</span> (item) (string-match <span class="org-string">"@"</span> item))
        (get-text-property 1 'tags txt))))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-compare-dates</span> (a b)
  <span class="org-doc">"Return 1 if A should go after B, -1 if B should go after A, or 0 if a = b."</span>
  (<span class="org-keyword">cond</span>
   ((and (= a 0) (= b 0)) nil)
   ((= a 0) 1)
   ((= b 0) -1)
   ((&gt; a b) 1)
   ((&lt; a b) -1)
   (t nil)))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-complete-cmp</span> (a b)
  (<span class="org-keyword">let*</span> ((state-a (or (get-text-property 1 'todo-state a) <span class="org-string">""</span>))
         (state-b (or (get-text-property 1 'todo-state b) <span class="org-string">""</span>)))
    (or
     (<span class="org-keyword">if</span> (member state-a org-done-keywords-for-agenda) 1)
     (<span class="org-keyword">if</span> (member state-b org-done-keywords-for-agenda) -1))))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-date-cmp</span> (a b)
  (<span class="org-keyword">let*</span> ((sched-a (or (get-text-property 1 'org-scheduled a) 0))
         (sched-b (or (get-text-property 1 'org-scheduled b) 0))
         (deadline-a (or (get-text-property 1 'org-deadline a) 0))
         (deadline-b (or (get-text-property 1 'org-deadline b) 0)))
    (or
     (sacha/org-compare-dates
      (sacha/org-min-date sched-a deadline-a)
      (sacha/org-min-date sched-b deadline-b)))))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-min-date</span> (a b)
  <span class="org-doc">"Return the smaller of A or B, except for 0."</span>
  (funcall (<span class="org-keyword">if</span> (and (&gt; a 0) (&gt; b 0)) 'min 'max) a b))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-sort-agenda-items-user-defined</span> (a b)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">compare by deadline, then scheduled date; done tasks are listed at the very bottom</span>
  (or
   (sacha/org-complete-cmp a b)
   (sacha/org-date-cmp a b)))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-context-cmp</span> (a b)
  <span class="org-doc">"Compare CONTEXT-A and CONTEXT-B."</span>
  (<span class="org-keyword">let</span> ((context-a (sacha/org-get-context a))
        (context-b (sacha/org-get-context b)))
    (<span class="org-keyword">cond</span>
     ((null context-a) +1)
     ((null context-b) -1)
     ((string&lt; context-a context-b) -1)
     ((string&lt; context-b context-a) +1)
     (t nil))))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-sort-agenda-items-todo</span> (a b)
  (or
   (org-cmp-time a b)
   (sacha/org-complete-cmp a b)
   (sacha/org-context-cmp a b)
   (sacha/org-date-cmp a b)
   (org-cmp-todo-state a b)
   (org-cmp-priority a b)
   (org-cmp-effort a b)))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-10-9" class="outline-5">
<h5 id="sec-1-5-10-9">Preventing things from falling through the cracks</h5>
<div class="outline-text-5" id="text-1-5-10-9">
<p>
This helps me keep track of unscheduled tasks, because I sometimes
forget to assign tasks a date. I also want to keep track of stuck projects.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-agenda-list-unscheduled</span> (<span class="org-type">&amp;rest</span> ignore)
  <span class="org-doc">"Create agenda view for tasks that are unscheduled and not done."</span>
  (<span class="org-keyword">let*</span> ((org-agenda-todo-ignore-with-date t)
         (org-agenda-overriding-header <span class="org-string">"List of unscheduled tasks: "</span>))
    (org-agenda-get-todos)))
(setq org-stuck-projects
      '(<span class="org-string">"+PROJECT-MAYBE-DONE"</span>
        (<span class="org-string">"TODO"</span>)
        nil
        <span class="org-string">"\\&lt;IGNORE\\&gt;"</span>))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-weekly-review" class="outline-4">
<h4 id="weekly-review"><a id="sec-1-5-11"></a>Weekly review</h4>
<div class="outline-text-4" id="text-weekly-review">
<p>
<a id="weekly-review"></a>
</p>

<p>
I want to try out grouping tasks by topic first, then breaking it
down into previous/next week.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">      (<span class="org-keyword">defun</span> <span class="org-function-name">sacha/quantified-get-hours</span> (category time-summary)
              <span class="org-doc">"Return the number of hours based on the time summary."</span>
              (<span class="org-keyword">if</span> (stringp category)
                 (<span class="org-keyword">if</span> (assoc category time-summary) (/ (cdr (assoc category time-summary)) 3600.0) 0)
                (apply '+ (mapcar (<span class="org-keyword">lambda</span> (x) (sacha/quantified-get-hours x time-summary)) category))))
      (<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-summarize-focus-areas</span> ()
        <span class="org-doc">"Summarize previous and upcoming tasks as a list."</span>
        (interactive)
        (<span class="org-keyword">let</span> ((base-date (apply 'encode-time (org-read-date-analyze <span class="org-string">"-fri"</span> nil '(0 0 0))))
              business relationships life business-next relationships-next life-next string start end time-summary
              biz-time)
          (setq start (format-time-string <span class="org-string">"%Y-%m-%d"</span> (days-to-time (- (time-to-number-of-days base-date) 6))))
          (setq end (format-time-string <span class="org-string">"%Y-%m-%d"</span> (days-to-time (1+ (time-to-number-of-days base-date)))))
          (setq time-summary (quantified-summarize-time start end))
          (setq biz-time (sacha/quantified-get-hours <span class="org-string">"Business"</span> time-summary))
          (<span class="org-keyword">save-window-excursion</span>
            (org-agenda nil <span class="org-string">"w"</span>)
            (setq string (buffer-string))
            (<span class="org-keyword">with-temp-buffer</span>
              (insert string)
              (goto-char (point-min))
              (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"^  </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">:]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">: +</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">Sched[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">:]+: +</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?TODO </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">[      ]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">:[[:alnum:]_@#%:]+:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?[        ]*$"</span> nil t)
                (<span class="org-keyword">cond</span>
                 ((string= (match-string 1) <span class="org-string">"routines"</span>) nil) <span class="org-comment-delimiter">; </span><span class="org-comment">skip routine tasks</span>
                 ((string= (match-string 1) <span class="org-string">"business"</span>)
                  (add-to-list 'business-next (concat <span class="org-string">"  - [ ] "</span> (match-string 3))))
                 ((string= (match-string 1) <span class="org-string">"people"</span>)
                  (add-to-list 'relationships-next (concat <span class="org-string">"  - [ ] "</span> (match-string 3))))
                 (t (add-to-list 'life-next (concat <span class="org-string">"  - [ ] "</span> (match-string 3))))))))
          (<span class="org-keyword">save-window-excursion</span>
            (org-agenda nil <span class="org-string">"w"</span>)
            (org-agenda-later -1)
            (org-agenda-log-mode 16)
            (setq string (buffer-string))
            <span class="org-comment-delimiter">;; </span><span class="org-comment">Get any completed tasks from the current week as well</span>
            (org-agenda-later 1)
            (org-agenda-log-mode 16)
            (setq string (concat string <span class="org-string">"\n"</span> (buffer-string)))
            (<span class="org-keyword">with-temp-buffer</span>
              (insert string)
              (goto-char (point-min))
              (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"^  </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">:]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">: +.*?State:.*?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">TODO</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">DONE</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">[       ]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">:[[:alnum:]_@#%:]+:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?[        ]*$"</span> nil t)
                (<span class="org-keyword">cond</span>
                 ((string= (match-string 1) <span class="org-string">"routines"</span>) nil) <span class="org-comment-delimiter">; </span><span class="org-comment">skip routine tasks</span>
                 ((string= (match-string 1) <span class="org-string">"business"</span>)
                  (add-to-list 'business (concat <span class="org-string">"  - [X] "</span> (match-string 2))))
                 ((string= (match-string 1) <span class="org-string">"people"</span>)
                  (add-to-list 'relationships (concat <span class="org-string">"  - [X] "</span> (match-string 2))))
                 (t (add-to-list 'life (concat <span class="org-string">"  - [X] "</span> (match-string 2))))))))
          (setq string
                (concat
                 (format <span class="org-string">"- *Business* (%.1fh - %d%%)\n"</span> biz-time (/ biz-time 1.68))
                 (mapconcat 'identity (sort business 'string&lt;) <span class="org-string">"\n"</span>) <span class="org-string">"\n"</span>
                 (mapconcat 'identity (sort business-next 'string&lt;) <span class="org-string">"\n"</span>)
                 <span class="org-string">"\n"</span>
                 (format <span class="org-string">"  - *Earn* (%.1fh - %d%% of Business)\n"</span>
                         (sacha/quantified-get-hours <span class="org-string">"Business - Earn"</span> time-summary)
                         (/ (sacha/quantified-get-hours <span class="org-string">"Business - Earn"</span> time-summary) (* 0.01 biz-time)))
                 (format <span class="org-string">"  - *Build* (%.1fh - %d%% of Business)\n"</span>
                         (sacha/quantified-get-hours <span class="org-string">"Business - Build"</span> time-summary)
                         (/ (sacha/quantified-get-hours <span class="org-string">"Business - Build"</span> time-summary) (* 0.01 biz-time)))
                 (format <span class="org-string">"    - *Drawing* (%.1fh)\n"</span>
                         (sacha/quantified-get-hours '(<span class="org-string">"Business - Build - Drawing"</span> <span class="org-string">"Business - Build - Book review"</span>)  time-summary))
                 (format <span class="org-string">"    - *Delegation* (%.1fh)\n"</span>
                         (sacha/quantified-get-hours <span class="org-string">"Business - Build - Delegation"</span> time-summary))
                 (format <span class="org-string">"    - *Packaging* (%.1fh)\n"</span>
                         (sacha/quantified-get-hours <span class="org-string">"Business - Build - Packaging"</span> time-summary))
                 (format <span class="org-string">"    - *Paperwork* (%.1fh)\n"</span>
                         (sacha/quantified-get-hours <span class="org-string">"Business - Build - Paperwork"</span>  time-summary))
                 (format <span class="org-string">"  - *Connect* (%.1fh - %d%% of Business)\n"</span>
                         (sacha/quantified-get-hours <span class="org-string">"Business - Connect"</span> time-summary)
                         (/ (sacha/quantified-get-hours <span class="org-string">"Business - Connect"</span> time-summary) (* 0.01 biz-time)))
                 (format <span class="org-string">"- *Relationships* (%.1fh - %d%%)\n"</span>
                         (sacha/quantified-get-hours '(<span class="org-string">"Discretionary - Social"</span> <span class="org-string">"Discretionary - Family"</span>) time-summary)
                         (/ (sacha/quantified-get-hours '(<span class="org-string">"Discretionary - Social"</span> <span class="org-string">"Discretionary - Family"</span>) time-summary) 1.68))
                 (mapconcat 'identity (sort relationships 'string&lt;) <span class="org-string">"\n"</span>) <span class="org-string">"\n"</span>
                 (mapconcat 'identity (sort relationships-next 'string&lt;) <span class="org-string">"\n"</span>)
                 <span class="org-string">"\n"</span>
                 (format <span class="org-string">"- *Discretionary - Productive* (%.1fh - %d%%)\n"</span>
                         (sacha/quantified-get-hours <span class="org-string">"Discretionary - Productive"</span> time-summary)
                         (/ (sacha/quantified-get-hours <span class="org-string">"Discretionary - Productive"</span> time-summary) 1.68))
                 (mapconcat 'identity (sort life 'string&lt;) <span class="org-string">"\n"</span>) <span class="org-string">"\n"</span>
                 (mapconcat 'identity (sort life-next 'string&lt;) <span class="org-string">"\n"</span>) <span class="org-string">"\n"</span>
                 (format <span class="org-string">"  - *Writing* (%.1fh)\n"</span>
                         (sacha/quantified-get-hours <span class="org-string">"Discretionary - Productive - Writing"</span> time-summary))
                 (format <span class="org-string">"- *Discretionary - Play* (%.1fh - %d%%)\n"</span>
                         (sacha/quantified-get-hours <span class="org-string">"Discretionary - Play"</span> time-summary)
                         (/ (sacha/quantified-get-hours <span class="org-string">"Discretionary - Play"</span> time-summary) 1.68))
<span class="org-comment-delimiter">;                 </span><span class="org-comment">(format "- *Discretionary - Travel* (%.1fh - %d%%)\n"</span>
<span class="org-comment-delimiter">;                         </span><span class="org-comment">(sacha/quantified-get-hours "Discretionary - Travel" time-summary)</span>
<span class="org-comment-delimiter">;                         </span><span class="org-comment">(/ (sacha/quantified-get-hours "Discretionary - Travel" time-summary) 1.68))</span>
                 (format <span class="org-string">"- *Personal routines* (%.1fh - %d%%)\n"</span>
                         (sacha/quantified-get-hours <span class="org-string">"Personal"</span> time-summary)
                         (/ (sacha/quantified-get-hours <span class="org-string">"Personal"</span> time-summary) 1.68))
                 (format <span class="org-string">"- *Unpaid work* (%.1fh - %d%%)\n"</span>
                         (sacha/quantified-get-hours <span class="org-string">"Unpaid work"</span> time-summary)
                         (/ (sacha/quantified-get-hours <span class="org-string">"Unpaid work"</span> time-summary) 1.68))
                 (format <span class="org-string">"- *Sleep* (%.1fh - %d%% - average of %.1f per day)\n"</span>
                         (sacha/quantified-get-hours <span class="org-string">"Sleep"</span> time-summary)
                         (/ (sacha/quantified-get-hours <span class="org-string">"Sleep"</span> time-summary) 1.68)
                         (/ (sacha/quantified-get-hours <span class="org-string">"Sleep"</span> time-summary) 7)
                         )))
          (<span class="org-keyword">if</span> (called-interactively-p 'any)
              (insert string)
            string)))
</pre>
</div>

<p>
I use this to put together a quick summary of how I spent my time.
</p>

<p>
The following code makes it easy to add a line:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-add-line-item-task</span> (task)
  (interactive <span class="org-string">"MTask: "</span>)
  (org-insert-heading)
  (insert <span class="org-string">"[ ] "</span> task)
  (<span class="org-keyword">let</span> ((org-capture-entry '(<span class="org-string">"t"</span> <span class="org-string">"Tasks"</span> entry
                             (file+headline <span class="org-string">"~/personal/organizer.org"</span> <span class="org-string">"Tasks"</span>)
                             <span class="org-string">""</span>)))
    (org-capture nil <span class="org-string">"t"</span>)
    (insert <span class="org-string">"TODO "</span> task <span class="org-string">"\nSCHEDULED: &lt;"</span> (org-read-date) <span class="org-string">"&gt;"</span>)))
(define-key org-mode-map (kbd <span class="org-string">"C-c t"</span>) 'sacha/org-add-line-item-task)
</pre>
</div>

<p>
Now we put it all together&#x2026;
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-prepare-weekly-review</span> ()
  <span class="org-doc">"Prepare weekly review template."</span>
  (interactive)
  (<span class="org-keyword">let</span> ((base-date (apply 'encode-time (org-read-date-analyze <span class="org-string">"-fri"</span> nil '(0 0 0))))
        (org-agenda-files '(<span class="org-string">"~/personal/organizer.org"</span> <span class="org-string">"~/personal/business.org"</span> <span class="org-string">"~/personal/people.org"</span>))
        start end)
    (setq start (format-time-string <span class="org-string">"%Y-%m-%d"</span> (days-to-time (- (time-to-number-of-days base-date) 6))))
    (setq end (format-time-string <span class="org-string">"%Y-%m-%d"</span> (days-to-time (1+ (time-to-number-of-days base-date)))))
      (insert
       (concat
        <span class="org-string">"*** Weekly review: Week ending "</span> (format-time-string <span class="org-string">"%B %e, %Y"</span> base-date) <span class="org-string">"  :weekly:\n"</span>
        <span class="org-string">"*Blog posts*\n\n"</span>
        <span class="org-string">"*Sketches*\n\n"</span> 
        (sacha/flickr-export-and-extract start end) <span class="org-string">"\n"</span>
        <span class="org-string">"*Link round-up*\n\n"</span>
        (sacha/evernote-export-and-extract start end)
        <span class="org-string">"\n\n*Focus areas and time review*\n\n"</span>
        (sacha/org-summarize-focus-areas)
        <span class="org-string">"\n"</span>))))
</pre>
</div>
</div>
<div id="outline-container-sec-1-5-11-1" class="outline-5">
<h5 id="sec-1-5-11-1">Flickr extract</h5>
<div class="outline-text-5" id="text-1-5-11-1">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/flickr-extract-links-for-review</span> (filename start end)
  <span class="org-doc">"Extract Flickr titles and URLs from FILENAME from START to END.</span>
<span class="org-doc">     The file should be a CSV downloaded by the Flickr metadata downloader.</span>
<span class="org-doc">     Start date and end date should be strings in the form yyyy-mm-dd."</span>
  (interactive (list (read-file-name <span class="org-string">"File: "</span>)
                          (org-read-date)
                          (org-read-date)))
       (<span class="org-keyword">require</span> '<span class="org-constant">csv</span>)
       (<span class="org-keyword">let</span> (list)
         (<span class="org-keyword">with-temp-buffer</span>
           (insert-file-contents filename)
           (goto-char (point-min))
           (setq list
                 (mapconcat
                  (<span class="org-keyword">lambda</span> (x) (concat <span class="org-string">"- [["</span> (car x) <span class="org-string">"]["</span> (cdr x) <span class="org-string">"]]"</span>))
                  (sort
                   (delq nil
                         (mapcar (<span class="org-keyword">lambda</span> (x)
                                   (<span class="org-keyword">let</span> ((title (cdr (assoc <span class="org-string">"FileName"</span> x))))
                                     (<span class="org-keyword">if</span> (and (not (string&lt; title start))
                                              (string&lt; title end))
                                         (cons (cdr (assoc <span class="org-string">"URL"</span> x)) title))))
                                 (csv-parse-buffer t)))
                   (<span class="org-keyword">lambda</span> (a b) (string&lt;  (cdr a) (cdr b))))
                  <span class="org-string">"\n"</span>))
           (setq list
                 (replace-regexp-in-string <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">-</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">-</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>
                                           <span class="org-string">"\\1.\\2.\\3"</span> list))
           (setq list
                 (replace-regexp-in-string <span class="org-string">"\\[\""</span> <span class="org-string">"["</span> list))
           (setq list
                 (replace-regexp-in-string <span class="org-string">"\"\\]"</span> <span class="org-string">"]"</span> list)))
         (<span class="org-keyword">if</span> (called-interactively-p 'any)
             (insert list)
           list)))

     (<span class="org-keyword">defun</span> <span class="org-function-name">sacha/flickr-export-and-extract</span> (start end)
       <span class="org-doc">"Download Flickr metadata and extract the relevant part."</span>
       (shell-command <span class="org-string">"c:/sacha/dropbox/bin/flickr.bat"</span>)
       (sacha/flickr-extract-links-for-review <span class="org-string">"c:/sacha/dropbox/bin/flickr_metadata.csv"</span> start end))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-11-2" class="outline-5">
<h5 id="sec-1-5-11-2">Link-related convenience functions</h5>
<div class="outline-text-5" id="text-1-5-11-2">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">kensanata/resolve-redirect</span> (url)
  <span class="org-doc">"Resolve shortened URL by launching `curl --head' and parsing the result."</span>
  (<span class="org-keyword">let*</span> ((curl (shell-command-to-string
                (format <span class="org-string">"curl --silent --head %s"</span> url)))
         (location (<span class="org-keyword">when</span> (and (string-match <span class="org-string">"^HTTP/1\.1 301"</span> curl)
                              (string-match <span class="org-string">"^Location: </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> curl))
                     (match-string 1 curl))))
    (or location url)))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/resolve-urls-in-region</span> (beg end)
  <span class="org-doc">"Expand URLs between BEG and END."</span>
  (interactive <span class="org-string">"r"</span>)
  (<span class="org-keyword">save-excursion</span>
    (<span class="org-keyword">save-restriction</span>
      (narrow-to-region beg end)
      (goto-char (point-min))
      (<span class="org-keyword">while</span> (re-search-forward org-bracket-link-regexp nil t)
        (replace-match (<span class="org-keyword">save-match-data</span> (kensanata/resolve-redirect
                                         (match-string 1))) t t nil 1))
      (goto-char (point-min))
      (<span class="org-keyword">while</span> (re-search-forward org-link-re-with-space nil t)
        (replace-match (<span class="org-keyword">save-match-data</span> (kensanata/resolve-redirect
                                         (match-string 0))) t t nil)))))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/open-urls-in-region</span> (beg end)
  <span class="org-doc">"Open URLs between BEG and END."</span>
  (interactive <span class="org-string">"r"</span>)
  (<span class="org-keyword">save-excursion</span>
    (<span class="org-keyword">save-restriction</span>
      (narrow-to-region beg end)
      (goto-char (point-min))
      (<span class="org-keyword">while</span> (re-search-forward org-plain-link-re nil t)
        (org-open-at-point)))))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-11-3" class="outline-5">
<h5 id="sec-1-5-11-3">Evernote-related extract</h5>
<div class="outline-text-5" id="text-1-5-11-3">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/evernote-export-and-extract</span> (start-date end-date)
  <span class="org-doc">"Extract notes created on or after START-DATE and before END-DATE."</span>
  (<span class="org-keyword">let</span> ((filename <span class="org-string">"c:/sacha/tmp/Evernote.enex"</span>))
    (call-process 
     <span class="org-string">"c:/Program Files (x86)/Evernote/Evernote/enscript.exe"</span>
     nil t t
     <span class="org-string">"exportNotes"</span>
     <span class="org-string">"/q"</span> (concat
           <span class="org-string">" tag:roundup"</span>
           <span class="org-string">" created:"</span> (replace-regexp-in-string <span class="org-string">"-"</span> <span class="org-string">""</span> start-date)
           <span class="org-string">" -created:"</span> (replace-regexp-in-string <span class="org-string">"-"</span> <span class="org-string">""</span> end-date))
     <span class="org-string">"/f"</span> filename)
    (sacha/evernote-extract-links-for-review filename)))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/evernote-extract-links-for-review</span> (filename)
  <span class="org-doc">"Extract note names and URLs from FILENAME.</span>
<span class="org-doc">     The file should be an ENEX export."</span>
  (interactive (list (read-file-name <span class="org-string">"File: "</span>)
                     (org-read-date)
                     (org-read-date)))
  (<span class="org-keyword">let</span> (list)
    (<span class="org-keyword">with-temp-buffer</span>
      (insert-file-contents filename)
      (goto-char (point-min))
      (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"&lt;title&gt;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.+?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">&lt;/title&gt;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*?\n</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">*?.*?href=\"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\""</span> nil t)
        (setq list
              (cons
               (cons
                (match-string-no-properties 1)
                (match-string-no-properties 3)) list))))
    (setq list
          (mapconcat (<span class="org-keyword">lambda</span> (x)
                       (concat <span class="org-string">"- [["</span>
                               (kensanata/resolve-redirect (cdr x))
                               <span class="org-string">"]["</span> (car x) <span class="org-string">"]]: "</span>)) list <span class="org-string">"\n"</span>))
          (<span class="org-keyword">if</span> (called-interactively-p 'any)
              (insert list)
            list)))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-12" class="outline-4">
<h4 id="sec-1-5-12">Viewing, navigating, and editing the Org tree</h4>
<div class="outline-text-4" id="text-1-5-12">
<p>
I often cut and paste subtrees. This makes it easier to cut
something and paste it elsewhere in the hierarchy.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">eval-after-load</span> 'org
  '(<span class="org-keyword">progn</span>
     (define-key org-mode-map (kbd <span class="org-string">"C-c k"</span>) 'org-cut-subtree)
     (setq org-yank-adjusted-subtrees t)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-13" class="outline-4">
<h4 id="sec-1-5-13">Fix timestamps in Flickr links</h4>
<div class="outline-text-4" id="text-1-5-13">
<p>
Photosync (for syncing with Flickr) can't deal with periods in filenames. Org gets confused with dashes in timestamps that are in link text. Solution? Save files with dashes, then use a little code to replace dashes in the region.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/fix-flickr-list</span> (beg end)
  (interactive <span class="org-string">"r"</span>)
  (<span class="org-keyword">save-excursion</span> (<span class="org-keyword">save-restriction</span>
    (narrow-to-region beg end)
    (goto-char (point-min))
    (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">-</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">-</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> nil t)
      (replace-match (concat (match-string 1) <span class="org-string">"."</span> (match-string 2) <span class="org-string">"."</span> (match-string 3)) nil t)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-14" class="outline-4">
<h4 id="sec-1-5-14">Organize my blog index</h4>
<div class="outline-text-4" id="text-1-5-14">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-file-blog-index-entries</span> (beg end location)
  <span class="org-doc">"Copy entries into blog.org."</span>
  (interactive
   (list
    (<span class="org-keyword">if</span> (region-active-p) (point) (line-beginning-position))
    (<span class="org-keyword">if</span> (region-active-p) (mark) (1+ (line-end-position)))
    (<span class="org-keyword">let</span> ((org-refile-targets
           '((<span class="org-string">"~/Dropbox/Public/blog.org"</span> . (<span class="org-builtin">:maxlevel</span> . 3))))
          (org-refile-use-cache nil))
      (org-refile-get-location <span class="org-string">"Location"</span>))))
  (<span class="org-keyword">let</span> ((s
         (replace-regexp-in-string
          <span class="org-string">"^ +- "</span>
          <span class="org-string">"- [X] "</span>
          (buffer-substring-no-properties beg end))))
    (<span class="org-keyword">save-window-excursion</span>
      (find-file (nth 1 location))
      (<span class="org-keyword">save-excursion</span>
        (<span class="org-keyword">save-restriction</span>
          (widen)
          (goto-char (nth 3 location))
          (looking-at org-outline-regexp)
          (forward-line 1)
          (insert s)
          (org-update-statistics-cookies nil))))))
(bind-key <span class="org-string">"C-c f"</span> 'sacha/org-file-blog-index-entries org-mode-map)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-15" class="outline-4">
<h4 id="sec-1-5-15">Publishing</h4>
<div class="outline-text-4" id="text-1-5-15">
<p>
Timestamps and section numbers make my published files look more
complicated than they are. Let's turn them off by default.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-export-with-section-numbers nil)
(setq org-html-include-timestamps nil)
</pre>
</div>

<p>
This makes it easier to publish my public Dropbox files:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">org-publish</span>)
(setq org-publish-project-alist
      '((<span class="org-string">"public"</span>
         <span class="org-builtin">:base-directory</span> <span class="org-string">"c:/sacha/Dropbox/public"</span>
         <span class="org-builtin">:base-extension</span> <span class="org-string">"org"</span>
         <span class="org-builtin">:publishing-directory</span> <span class="org-string">"c:/sacha/Dropbox/public"</span>
         <span class="org-builtin">:publishing-function</span> org-publish-org-to-html
         )))
</pre>
</div>

<p>
I use org2blog to post to my blog, which is Wordpress-based. I used to
use punchagan's org2blog, but there's a completely different one in
ELPA, so I figured I'd give that a try.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(sacha/package-install 'org2blog)
(<span class="org-keyword">require</span> '<span class="org-constant">org2blog-autoloads</span>)
(setq org-export-with-toc nil)
(setq org-export-htmlize-output-type 'css)
</pre>
</div>

<p>
I want to be able to export without having to say yes to code blocks all the time.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-html-export-trustingly</span> ()
  (interactive)
  (<span class="org-keyword">let</span> ((org-confirm-babel-evaluate nil))
    (org-html-export-to-html)))
</pre>
</div>
</div>
<div id="outline-container-sec-1-5-15-1" class="outline-5">
<h5 id="sec-1-5-15-1">Stylesheet / header</h5>
<div class="outline-text-5" id="text-1-5-15-1">
<p>
Might as well take advantage of my stylesheet:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-html-head <span class="org-string">"&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"http://sachachua.com/blog/wp-content/themes/sacha-v3/foundation/css/foundation.min.css\"&gt;&lt;/link&gt;</span>
<span class="org-string">&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"http://sachachua.com/org-export.css\"&gt;&lt;/link&gt;</span>
<span class="org-string">&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"http://sachachua.com/blog/wp-content/themes/sacha-v3/style.css\"&gt;&lt;/link&gt;"</span>)
(setq org-html-preamble nil)
(setq org-html-postamble nil)
(setq org-html-htmlize-output-type 'css)
(setq org-src-fontify-natively t)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-15-2" class="outline-5">
<h5 id="sec-1-5-15-2">Copy region</h5>
<div class="outline-text-5" id="text-1-5-15-2">
<p>
Sometimes I want a region's HTML in my kill-ring/clipboard without any of the extra fluff:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-copy-region-as-html</span> (beg end)
  <span class="org-doc">"Make it easier to copy code for Wordpress posts and other things."</span>
  (interactive <span class="org-string">"r"</span>)
  (<span class="org-keyword">let</span> ((org-export-html-preamble nil))
    (kill-new
     (org-export-string-as (buffer-substring beg end) 'html t))))
</pre>
</div>

<p>
Sometimes I want a subtree:
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-copy-subtree-as-html</span> ()
  (interactive)
  (sacha/org-copy-region-as-html
   (org-back-to-heading)
   (org-end-of-subtree)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-15-3" class="outline-5">
<h5 id="sec-1-5-15-3">UTF-8 checkboxes</h5>
<div class="outline-text-5" id="text-1-5-15-3">
<p>
This snippet turns <code>- [X]</code> into ☑ and <code>- [ ]</code> into ☐. Yay!
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-html-checkbox</span> (checkbox)
  <span class="org-doc">"Format CHECKBOX into HTML."</span>
  (<span class="org-keyword">case</span> checkbox (on <span class="org-string">"&lt;span class=\"check\"&gt;&amp;#x2611;&lt;/span&gt;"</span>) <span class="org-comment-delimiter">; </span><span class="org-comment">checkbox (checked)</span>
        (off <span class="org-string">"&lt;span class=\"checkbox\"&gt;&amp;#x2610;&lt;/span&gt;"</span>)
        (trans <span class="org-string">"&lt;code&gt;[-]&lt;/code&gt;"</span>)
        (t <span class="org-string">""</span>)))
(<span class="org-keyword">defadvice</span> <span class="org-function-name">org-html-checkbox</span> (around sacha activate)
  (setq ad-return-value (sacha/org-html-checkbox (ad-get-arg 0))))
</pre>
</div>

<p>
To find this code, I searched <code>ox-html.el</code> for <code>[</code>. Eventually I found <code>org-html-checkbox</code>, which is directly called by <code>org-html-format-list-item</code> instead of being a function variable that you can change. So that meant I needed to override the behaviour of <code>org-html-checkbox</code> through <code>defadvice</code>. You can see above how I wrap advice around <code>org-html-checkbox</code> and replace the return value with my own function. For more about advice, read the Emacs Lisp Intro manual.
</p>

<p>
Inspired by Grant from <a href="http://www.wisdomandwonder.com/article/8284/creation-and-conservation-of-computer-files-c3f/comment-page-1#comment-1086101">Wisdom and Wonder</a>.
</p>
</div>
</div>
</div>
<div id="outline-container-sec-1-5-16" class="outline-4">
<h4 id="sec-1-5-16">Structure templates</h4>
<div class="outline-text-4" id="text-1-5-16">
<p>
Org makes it easy to insert blocks by typing <code>&lt;s[TAB]</code>, etc.
I hardly ever use LaTeX, but I insert a lot of Emacs Lisp blocks, so I
redefine <code>&lt;l</code> to insert a Lisp block instead.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-structure-template-alist 
      '((<span class="org-string">"s"</span> <span class="org-string">"#+begin_src ?\n\n#+end_src"</span> <span class="org-string">"&lt;src lang=\"?\"&gt;\n\n&lt;/src&gt;"</span>)
        (<span class="org-string">"e"</span> <span class="org-string">"#+begin_example\n?\n#+end_example"</span> <span class="org-string">"&lt;example&gt;\n?\n&lt;/example&gt;"</span>)
        (<span class="org-string">"q"</span> <span class="org-string">"#+begin_quote\n?\n#+end_quote"</span> <span class="org-string">"&lt;quote&gt;\n?\n&lt;/quote&gt;"</span>)
        (<span class="org-string">"v"</span> <span class="org-string">"#+BEGIN_VERSE\n?\n#+END_VERSE"</span> <span class="org-string">"&lt;verse&gt;\n?\n&lt;/verse&gt;"</span>)
        (<span class="org-string">"c"</span> <span class="org-string">"#+BEGIN_COMMENT\n?\n#+END_COMMENT"</span>)
        (<span class="org-string">"l"</span> <span class="org-string">"#+begin_src emacs-lisp\n?\n#+end_src"</span> <span class="org-string">"&lt;src lang=\"emacs-lisp\"&gt;\n?\n&lt;/src&gt;"</span>)
        (<span class="org-string">"L"</span> <span class="org-string">"#+latex: "</span> <span class="org-string">"&lt;literal style=\"latex\"&gt;?&lt;/literal&gt;"</span>)
        (<span class="org-string">"h"</span> <span class="org-string">"#+begin_html\n?\n#+end_html"</span> <span class="org-string">"&lt;literal style=\"html\"&gt;\n?\n&lt;/literal&gt;"</span>)
        (<span class="org-string">"H"</span> <span class="org-string">"#+html: "</span> <span class="org-string">"&lt;literal style=\"html\"&gt;?&lt;/literal&gt;"</span>)
        (<span class="org-string">"a"</span> <span class="org-string">"#+begin_ascii\n?\n#+end_ascii"</span>)
        (<span class="org-string">"A"</span> <span class="org-string">"#+ascii: "</span>)
        (<span class="org-string">"i"</span> <span class="org-string">"#+index: ?"</span> <span class="org-string">"#+index: ?"</span>)
        (<span class="org-string">"I"</span> <span class="org-string">"#+include %file ?"</span> <span class="org-string">"&lt;include file=%file markup=\"?\"&gt;"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-17" class="outline-4">
<h4 id="sec-1-5-17">Quick links</h4>
<div class="outline-text-4" id="text-1-5-17">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-link-abbrev-alist
  '((<span class="org-string">"google"</span> . <span class="org-string">"http://www.google.com/search?q="</span>)
    (<span class="org-string">"gmap"</span> . <span class="org-string">"http://maps.google.com/maps?q=%s"</span>)
    (<span class="org-string">"blog"</span> . <span class="org-string">"http://sachachua.com/blog/p/"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-18" class="outline-4">
<h4 id="sec-1-5-18">MobileOrg for Android</h4>
<div class="outline-text-4" id="text-1-5-18">
<p>
I've been playing around with MobileOrg so that I can review my
agenda and capture notes on my smartphone. My main Org file is too
big to open easily there, though.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">org-mobile</span>
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">progn</span>
    (autoload 'org-mobile-pull <span class="org-string">"org-mobile"</span> nil t)
    (autoload 'org-mobile-push <span class="org-string">"org-mobile"</span> nil t))
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">progn</span>
    (setq org-mobile-directory <span class="org-string">"~/Dropbox/mobile"</span>)
    (setq org-mobile-inbox-for-pull <span class="org-string">"~/personal/mobileorg.org"</span>)
    (setq default-buffer-file-coding-system 'utf-8)
    (setq org-mobile-files '(<span class="org-string">"/cygdrive/c/sacha/personal/organizer.org"</span> <span class="org-string">"/cygdrive/c/sacha/personal/business.org"</span> <span class="org-string">"/cygdrive/c/sacha/personal/books.org"</span>))
    (setq org-mobile-agendas '(<span class="org-string">"a"</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-19" class="outline-4">
<h4 id="sec-1-5-19">Clocking</h4>
<div class="outline-text-4" id="text-1-5-19">
<p>
Too many clock entries clutter up a heading.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-log-into-drawer <span class="org-string">"LOGBOOK"</span>)
(setq org-clock-into-drawer 1)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-20" class="outline-4">
<h4 id="sec-1-5-20">Speed commands</h4>
<div class="outline-text-4" id="text-1-5-20">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-use-effective-time t)
(setq org-use-speed-commands t)
(add-to-list 'org-speed-commands-user '(<span class="org-string">"x"</span> org-todo <span class="org-string">"DONE"</span>))
(add-to-list 'org-speed-commands-user '(<span class="org-string">"y"</span> org-todo-yesterday <span class="org-string">"DONE"</span>))
(add-to-list 'org-speed-commands-user '(<span class="org-string">"!"</span> sacha/org-clock-in-and-track))
(add-to-list 'org-speed-commands-user '(<span class="org-string">"s"</span> call-interactively 'org-schedule))
(add-to-list 'org-speed-commands-user '(<span class="org-string">"i"</span> call-interactively 'org-clock-in))
(add-to-list 'org-speed-commands-user '(<span class="org-string">"o"</span> call-interactively 'org-clock-out))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-21" class="outline-4">
<h4 id="sec-1-5-21">My files</h4>
<div class="outline-text-4" id="text-1-5-21">
<p>
#<a id="org-files"></a>
</p>

<p>
Here are the Org files I use. I should probably organize them better. =)
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />

<col  class="left" />
</colgroup>
<tbody>
<tr>
<td class="left">organizer.org</td>
<td class="left">My main Org file. Inbox for M-x org-capture, tasks, weekly reviews, etc.</td>
</tr>

<tr>
<td class="left">emacs.org</td>
<td class="left">Interesting Emacs snippets. Used to be in outline.org, but got to be pretty big</td>
</tr>

<tr>
<td class="left">business.org</td>
<td class="left">Business-related notes and TODOs</td>
</tr>

<tr>
<td class="left">decisions.org</td>
<td class="left">Pending, current, and reviewed decisions</td>
</tr>

<tr>
<td class="left">outline.org</td>
<td class="left">Huge outline of notes by category</td>
</tr>

<tr>
<td class="left">tracking.org</td>
<td class="left">Temporary Org file for tracking various things</td>
</tr>

<tr>
<td class="left">delegation.org</td>
<td class="left">Templates for assigning tasks</td>
</tr>

<tr>
<td class="left">books.org</td>
<td class="left">Huge file with book notes</td>
</tr>

<tr>
<td class="left">calendar.org</td>
<td class="left">Used to use this with ical2org, but have been having problems with ical2org lately</td>
</tr>

<tr>
<td class="left">contacts.org</td>
<td class="left">People-related notes using org-contacts</td>
</tr>

<tr>
<td class="left">blog.org</td>
<td class="left">Topic index for my blog</td>
</tr>

<tr>
<td class="left">t420.org</td>
<td class="left">Miscellaneous notes related to old projects</td>
</tr>

<tr>
<td class="left">learning.org</td>
<td class="left">Learning plan</td>
</tr>

<tr>
<td class="left">ideal.org</td>
<td class="left">Planning ideal days</td>
</tr>

<tr>
<td class="left">archive.org</td>
<td class="left">Archived subtrees</td>
</tr>

<tr>
<td class="left">latin.org</td>
<td class="left">Latin notes</td>
</tr>

<tr>
<td class="left">preparation.org</td>
<td class="left">Things I think about and plan ahead for, so that I can be less nervous about them.</td>
</tr>

<tr>
<td class="left">101things.org</td>
<td class="left">Old goals for 101 things in 1001 days</td>
</tr>

<tr>
<td class="left">org-talk.org</td>
<td class="left">Notes for my talk in Org</td>
</tr>

<tr>
<td class="left">life.org</td>
<td class="left">Questions, processes, tools</td>
</tr>

<tr>
<td class="left">quotes.org</td>
<td class="left">Quotations</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="outline-container-sec-1-5-22" class="outline-4">
<h4 id="sec-1-5-22">Attachments</h4>
<div class="outline-text-4" id="text-1-5-22">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-attach-store-link-p t)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-23" class="outline-4">
<h4 id="sec-1-5-23">Encryption</h4>
<div class="outline-text-4" id="text-1-5-23">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">org-crypt</span>)
(org-crypt-use-before-save-magic)
(setq org-tags-exclude-from-inheritance (quote (<span class="org-string">"crypt"</span>)))

(setq org-crypt-key nil)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">GPG key to use for encryption</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Either the Key ID or set to nil to use symmetric encryption.</span>

  <span class="org-comment-delimiter">;;     </span><span class="org-comment">(setq auto-save-default nil)</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Auto-saving does not cooperate with org-crypt.el: so you need</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">to turn it off if you plan to use org-crypt.el quite often.</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Otherwise, you'll get an (annoying) message each time you</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">start Org.</span>

  <span class="org-comment-delimiter">;; </span><span class="org-comment">To turn it off only locally, you can insert this:</span>
  <span class="org-comment-delimiter">;;</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment"># -*- buffer-auto-save-file-name: nil; -*-</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-24" class="outline-4">
<h4 id="sec-1-5-24">Counting</h4>
<div class="outline-text-4" id="text-1-5-24">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-summarize-task-status</span> ()
  <span class="org-doc">"Count number of tasks by status. </span>
<span class="org-doc">Probably should make this a dblock someday."</span>
  (interactive)
  (<span class="org-keyword">let</span> (result)
    (org-map-entries
     (<span class="org-keyword">lambda</span> ()
       (<span class="org-keyword">let</span> ((todo (elt (org-heading-components) 2)))
         (<span class="org-keyword">if</span> todo
             (<span class="org-keyword">if</span> (assoc todo result)
                 (setcdr (assoc todo result)
                         (1+ (cdr (assoc todo result))))
               (setq result (cons (cons todo 1) result)))))))
    (message <span class="org-string">"%s"</span> (mapconcat (<span class="org-keyword">lambda</span> (x) (format <span class="org-string">"%s: %d"</span> (car x) (cdr x)))
                             result <span class="org-string">"\n"</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-5-25" class="outline-4">
<h4 id="sec-1-5-25">Diagrams and graphics</h4>
<div class="outline-text-4" id="text-1-5-25">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq org-ditaa-jar-path <span class="org-string">"C:/Sacha/Dropbox/bin/ditaa.jar"</span>)
(setq org-startup-with-inline-images t)
(add-hook 'org-babel-after-execute-hook 'org-display-inline-images)
(org-babel-do-load-languages
 'org-babel-load-languages
 '((dot . t)
   (ditaa . t)))
(add-to-list 'org-src-lang-modes '(<span class="org-string">"dot"</span> . graphviz-dot))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6">Coding</h3>
<div class="outline-text-3" id="text-1-6">
</div><div id="outline-container-sec-1-6-1" class="outline-4">
<h4 id="sec-1-6-1">General preferences</h4>
<div class="outline-text-4" id="text-1-6-1">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq tab-width 4)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-6-2" class="outline-4">
<h4 id="sec-1-6-2">Use Cygwin</h4>
<div class="outline-text-4" id="text-1-6-2">
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;</span><span class="org-comment">(setenv "PATH" (concat "c:/cygwin/bin;" (getenv "PATH")))</span>
<span class="org-comment-delimiter">;</span><span class="org-comment">(add-to-list 'exec-path "c:/cygwin/bin/" t) </span>
<span class="org-comment-delimiter">;</span><span class="org-comment">(require 'cygwin-mount)</span>
<span class="org-comment-delimiter">;</span><span class="org-comment">(cygwin-mount-activate)</span>
(add-hook 'comint-output-filter-functions
    'shell-strip-ctrl-m nil t)
(add-hook 'comint-output-filter-functions
    'comint-watch-for-password-prompt nil t)
<span class="org-comment-delimiter">;</span><span class="org-comment">(setq explicit-shell-file-name "cmdproxy.exe")</span>
<span class="org-comment-delimiter">;</span><span class="org-comment">(setq explicit-shell-file-name "bash.exe")</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">For subprocesses invoked via the shell</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">(e.g., "shell -c command")</span>
<span class="org-comment-delimiter">;</span><span class="org-comment">(setq shell-file-name explicit-shell-file-name)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-6-3" class="outline-4">
<h4 id="sec-1-6-3">Drupal</h4>
<div class="outline-text-4" id="text-1-6-3">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">define-derived-mode</span> <span class="org-function-name">drupal-mode</span> php-mode <span class="org-string">"Drupal"</span>
  <span class="org-doc">"Major mode for Drupal source code.</span>
<span class="org-doc">\\{drupal-mode-map}"</span>
  (setq case-fold-search t) 
  (setq indent-tabs-mode nil)
  (setq c-basic-offset 2)
  (setq indent-tabs-mode nil)
  (setq tab-width 2)
  (setq fill-column 78)
  (c-set-offset 'arglist-cont 0)
  (c-set-offset 'arglist-intro '+)
  (c-set-offset 'case-label 2)
  (c-set-offset 'arglist-close 0)
  (setq yas/buffer-local-condition 
  '(<span class="org-keyword">cond</span>
   ((looking-at <span class="org-string">"\\w"</span>) nil)
   ((and
     (not (bobp))
     (or (equal <span class="org-string">"font-lock-comment-face"</span>
                (get-char-property (1- (point)) 'face))
         (equal <span class="org-string">"font-lock-string-face"</span>
                (get-char-property (1- (point)) 'face))))
    '(require-snippet-condition . force-in-comment))
   (t t))))
(define-key drupal-mode-map (kbd <span class="org-string">"TAB"</span>) 'indent-according-to-mode)
(add-hook 'drupal-mode-hook (<span class="org-keyword">lambda</span> () (flymake-mode 1)))
(add-hook 'drupal-mode-hook (<span class="org-keyword">lambda</span> () (yas/minor-mode 1)))
(add-to-list 'auto-mode-alist '(<span class="org-string">"\\.</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">php</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">test</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">module</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">inc</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">install</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">engine</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">profile</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">.theme</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">$"</span> . drupal-mode))
(add-to-list 'auto-mode-alist '(<span class="org-string">"\\.tpl.php$"</span> . html-helper-mode))
(define-key drupal-mode-map '[M-S-up] 'flymake-goto-prev-error)
(define-key drupal-mode-map '[M-S-down] 'flymake-goto-next-error)
(define-key drupal-mode-map (kbd <span class="org-string">"C-c C-c"</span>) 'comment-dwim)

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/drupal-module-name</span> ()
  <span class="org-doc">"Return the Drupal module name for .module and .install files."</span>    (file-name-sans-extension (file-name-nondirectory
                             (buffer-file-name))))
(add-to-list 'hs-special-modes-alist '(drupal-mode <span class="org-string">"{"</span> <span class="org-string">"}"</span> <span class="org-string">"/[*/]"</span> nil hs-c-like-adjust-block-beginning))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-6-4" class="outline-4">
<h4 id="sec-1-6-4">Expand region</h4>
<div class="outline-text-4" id="text-1-6-4">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(sacha/package-install 'expand-region)
(<span class="org-keyword">use-package</span> <span class="org-constant">expand-region</span>
  <span class="org-builtin">:bind</span> (<span class="org-string">"C-="</span> . er/expand-region))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-6-5" class="outline-4">
<h4 id="sec-1-6-5">Tag files</h4>
<div class="outline-text-4" id="text-1-6-5">
<p>
I don't want to have to set my tags file per project, so I search
for it in the directory tree instead.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/recursive-find-file</span> (file <span class="org-type">&amp;optional</span> directory)
  <span class="org-doc">"Find the first FILE in DIRECTORY or its parents."</span>
  (setq directory (or directory (file-name-directory (buffer-file-name)) (pwd)))
  (<span class="org-keyword">if</span> (file-exists-p (expand-file-name file directory))
      (expand-file-name file directory)
    (<span class="org-keyword">unless</span> (string= directory <span class="org-string">"/"</span>)
      (sacha/recursive-find-file file (expand-file-name <span class="org-string">".."</span> directory)))))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/find-tags</span> ()
  <span class="org-doc">"Set the TAGS file."</span>
  (set (make-variable-buffer-local 'tags-table-list) nil)
  (set (make-variable-buffer-local 'tags-file-name) 
       (sacha/recursive-find-file <span class="org-string">"TAGS"</span>)))

(<span class="org-keyword">eval-after-load</span> 'drupal-mode
  '(<span class="org-keyword">progn</span>
     (add-hook 'drupal-mode-hook 'sacha/find-tags)))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-6-6" class="outline-4">
<h4 id="sec-1-6-6">Emacs Lisp</h4>
<div class="outline-text-4" id="text-1-6-6">
</div><div id="outline-container-sec-1-6-6-1" class="outline-5">
<h5 id="sec-1-6-6-1">Edebug</h5>
<div class="outline-text-5" id="text-1-6-6-1">
<p>
Did you know edebug has a trace function? I didn't. Thanks, agumonkey!
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq edebug-trace t)
</pre>
</div>

<p>
While edebugging, use T to view a trace buffer (<code>*edebug-trace*</code>).
Emacs will quickly execute the rest of your code, printing out the
arguments and return values for each expression it evaluates.
</p>
</div>
</div>
<div id="outline-container-sec-1-6-6-2" class="outline-5">
<h5 id="sec-1-6-6-2">Eldoc</h5>
<div class="outline-text-5" id="text-1-6-6-2">
<p>
Eldoc provides minibuffer hints when working with Emacs Lisp.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(autoload 'turn-on-eldoc-mode <span class="org-string">"eldoc"</span> nil t)
(add-hook 'emacs-lisp-mode-hook 'turn-on-eldoc-mode)
(add-hook 'lisp-interaction-mode-hook 'turn-on-eldoc-mode)
(add-hook 'ielm-mode-hook 'turn-on-eldoc-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-6-6-3" class="outline-5">
<h5 id="sec-1-6-6-3"><a id="ID-99ac7ddb-08ef-46c4-8fa8-8a45164f9ef4"></a>Refactoring&#xa0;&#xa0;&#xa0;<span class="tag"><span class="drill">drill</span></span></h5>
<div class="outline-text-5" id="text-1-6-6-3">
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">C-c C-v l : elint current buffer in clean environment.</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">C-c C-v L : elint current buffer by multiple emacs binaries.</span>
<span class="org-comment-delimiter">;;             </span><span class="org-comment">See `</span><span class="org-comment"><span class="org-constant">erefactor-lint-emacsen</span></span><span class="org-comment">'</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">C-c C-v r : Rename symbol in current buffer.</span>
<span class="org-comment-delimiter">;;             </span><span class="org-comment">Resolve `</span><span class="org-comment"><span class="org-constant">let</span></span><span class="org-comment">' binding as long as i can.</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">C-c C-v R : Rename symbol in requiring modules and current buffer.</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">C-c C-v h : Highlight current symbol in this buffer</span>
<span class="org-comment-delimiter">;;             </span><span class="org-comment">and suppress `</span><span class="org-comment"><span class="org-constant">erefacthr-highlight-mode</span></span><span class="org-comment">'.</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">C-c C-v d : Dehighlight all by above command.</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">C-c C-v c : Switch prefix bunch of symbols.</span>
<span class="org-comment-delimiter">;;             </span><span class="org-comment">ex: '(hoge-var hoge-func) -&gt; '(foo-var foo-func)</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">C-c C-v ? : Display flymake elint warnings/errors</span>

  (<span class="org-keyword">use-package</span> <span class="org-constant">erefactor</span>
    <span class="org-builtin">:config</span>
    (define-key emacs-lisp-mode-map <span class="org-string">"\C-c\C-v"</span> erefactor-map))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-6-6-4" class="outline-5">
<h5 id="sec-1-6-6-4">Jumping to code</h5>
<div class="outline-text-5" id="text-1-6-6-4">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(define-key emacs-lisp-mode-map (kbd <span class="org-string">"C-c ."</span>) 'find-function-at-point)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-6-7" class="outline-4">
<h4 id="sec-1-6-7">Snippets</h4>
<div class="outline-text-4" id="text-1-6-7">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">yasnippet-bundle</span>
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">progn</span>
    (yas/initialize)
    (yas/load-directory <span class="org-string">"~/elisp/snippets"</span>)
    (setq yas/key-syntaxes '(<span class="org-string">"w_"</span> <span class="org-string">"w_."</span> <span class="org-string">"^ "</span>))))
<span class="org-comment-delimiter">;;        </span><span class="org-comment">(global-set-key (kbd "C-c y") (lambda () (interactive)</span>
<span class="org-comment-delimiter">;;                                         </span><span class="org-comment">(yas/load-directory "~/elisp/snippets")))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-6-8" class="outline-4">
<h4 id="sec-1-6-8">Show more information</h4>
<div class="outline-text-4" id="text-1-6-8">
<p>
I sometimes need to know where I am in a line.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(column-number-mode 1)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-6-9" class="outline-4">
<h4 id="sec-1-6-9">Don't show whitespace in diff, but show context</h4>
<div class="outline-text-4" id="text-1-6-9">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq vc-diff-switches '(<span class="org-string">"-b"</span> <span class="org-string">"-B"</span> <span class="org-string">"-u"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-6-10" class="outline-4">
<h4 id="sec-1-6-10">Javascript</h4>
<div class="outline-text-4" id="text-1-6-10">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">js2-mode</span>
  <span class="org-builtin">:commands</span> js2-mode
  <span class="org-builtin">:init</span>
    (add-to-list 'auto-mode-alist '(<span class="org-string">"\\.js$"</span> . js2-mode))
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">progn</span> 
    (bind-key <span class="org-string">"C-x C-e"</span> 'js-send-last-sexp js2-mode-map)
    (bind-key <span class="org-string">"C-M-x"</span> 'js-send-last-sexp-and-go js2-mode-map)
    (bind-key <span class="org-string">"C-c b"</span> 'js-send-buffer js2-mode-map)
    (bind-key <span class="org-string">"C-c C-b"</span> 'js-send-buffer-and-go js2-mode-map)
    (bind-key <span class="org-string">"C-c l"</span> 'js-load-file-and-go js2-mode-map)))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-6-11" class="outline-4">
<h4 id="sec-1-6-11">NodeJS</h4>
<div class="outline-text-4" id="text-1-6-11">
<p>
From <a href="http://www.emacswiki.org/emacs/NodeJs">http://www.emacswiki.org/emacs/NodeJs</a>
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">node-repl</span> () (interactive)
  (pop-to-buffer (make-comint <span class="org-string">"node-repl"</span> <span class="org-string">"node"</span> nil <span class="org-string">"--interactive"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-6-12" class="outline-4">
<h4 id="sec-1-6-12">Magit</h4>
<div class="outline-text-4" id="text-1-6-12">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">magit</span>
  <span class="org-builtin">:init</span> (setq magit-diff-options '(<span class="org-string">"-b"</span>)) <span class="org-comment-delimiter">; </span><span class="org-comment">ignore whitespace</span>
  <span class="org-builtin">:bind</span> (<span class="org-string">"C-x v d"</span> . magit-status))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7">Ledger (personal finance)</h3>
<div class="outline-text-3" id="text-1-7">
<p>
This isn't a package yet, so I manually load it when I want to.
</p>
</div>

<div id="outline-container-sec-1-7-1" class="outline-4">
<h4 id="sec-1-7-1">Make it easier to review my credit card transactions</h4>
<div class="outline-text-4" id="text-1-7-1">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/ledger-go-to-beginning-of-entry</span> ()
  <span class="org-doc">"Move to the beginning of the current entry."</span>
  (<span class="org-keyword">while</span> (and (not (bobp))
              (eq (ledger-context-line-type (ledger-context-at-point))
                  'acct-transaction))
    (forward-line -1)))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/ledger-entry-date</span> ()
  <span class="org-doc">"Returns the date of the entry containing point or nil."</span>
  (<span class="org-keyword">save-excursion</span>
    (sacha/ledger-go-to-beginning-of-entry)
    (<span class="org-keyword">let</span> ((context-info (ledger-context-other-line 0)))
      (<span class="org-keyword">when</span> (eq (ledger-context-line-type context-info) 'entry)
        (goto-char (line-beginning-position))
        (<span class="org-keyword">if</span> (looking-at <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[-0-9\\./]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>)
            (match-string-no-properties 1))))))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/ledger-guess-mbna</span> ()
  <span class="org-doc">"Adds a sub-account for the dates for my credit card transactions."</span>
  (interactive)
  (<span class="org-keyword">save-excursion</span>
    (sacha/ledger-go-to-beginning-of-entry)
    (forward-line 1)
    (<span class="org-keyword">let</span> ((amount 0) (date (sacha/ledger-entry-date)) month)
      (<span class="org-keyword">if</span> (string-match <span class="org-string">"[0-9]+[-\\.]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">[-\\.]</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[0-9]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> date)
          (setq month (string-to-number (match-string 1 date))))
      <span class="org-comment-delimiter">;; </span><span class="org-comment">Is this a payment or a charge?</span>
      (<span class="org-keyword">save-excursion</span>
        (<span class="org-keyword">while</span> (and (eq (ledger-context-line-type (ledger-context-at-point))
                        'acct-transaction)
                    (not (eobp)))
          (<span class="org-keyword">let</span> ((context (ledger-context-at-point)))
            (<span class="org-keyword">if</span> (ledger-context-field-value context 'amount)
                (<span class="org-keyword">if</span> (string-match <span class="org-string">"MBNA"</span> (ledger-context-field-value context 'account))
                    (setq amount (string-to-number (ledger-context-field-value context 'amount)))
                  (setq amount (- (string-to-number (ledger-context-field-value context 'amount)))))))
          (forward-line 1)))
      (<span class="org-keyword">save-excursion</span>
        (<span class="org-keyword">while</span> (and (eq (ledger-context-line-type (ledger-context-at-point))
                        'acct-transaction)
                    (not (eobp)))
          (<span class="org-keyword">let</span> ((context (ledger-context-at-point)))
            (<span class="org-keyword">if</span> (string-match <span class="org-string">"MBNA"</span> (ledger-context-field-value context 'account))
                (<span class="org-keyword">if</span> (re-search-forward <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">MBNA</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">[ \t]*[-$\.0-9]*[ \t]*$"</span> (line-end-position) t)
                    (replace-match
                     (concat <span class="org-string">"MBNA:"</span>
                             (elt
                              '(<span class="org-string">"January"</span> <span class="org-string">"February"</span> <span class="org-string">"March"</span> <span class="org-string">"April"</span> <span class="org-string">"May"</span> <span class="org-string">"June"</span> <span class="org-string">"July"</span> <span class="org-string">"August"</span> <span class="org-string">"September"</span> <span class="org-string">"October"</span> <span class="org-string">"November"</span> <span class="org-string">"December"</span>)
                              (% (+ (<span class="org-keyword">if</span> (&gt; amount 0) 10 11) month) 12)))
                             t t nil 1))))
          (forward-line 1))))))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-8" class="outline-3">
<h3 id="sec-1-8">Fun and games</h3>
<div class="outline-text-3" id="text-1-8">
</div><div id="outline-container-sec-1-8-1" class="outline-4">
<h4 id="sec-1-8-1">Typing of Emacs</h4>
<div class="outline-text-4" id="text-1-8-1">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">typing</span>
  <span class="org-builtin">:init</span>
  (autoload 'typing-of-emacs <span class="org-string">"typing"</span> nil t)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">progn</span>
    (setq toe-starting-length 6)
    (setq toe-starting-time-per-word 2)
    (setq toe-max-length 20)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-8-2" class="outline-4">
<h4 id="sec-1-8-2">Internet Relay Chat</h4>
<div class="outline-text-4" id="text-1-8-2">
<p>
IRC is a great way to hang out with other Emacs geeks.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">erc</span>
  <span class="org-builtin">:config</span>
  (setq erc-autojoin-channels-alist '((<span class="org-string">"freenode.net"</span>
                                       <span class="org-string">"#org-mode"</span>
                                       <span class="org-string">"#hacklabto"</span>
                                       <span class="org-string">"#emacs"</span>))
        erc-server <span class="org-string">"irc.freenode.net"</span>
        erc-nick <span class="org-string">"sachac"</span>))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-9" class="outline-3">
<h3 id="sec-1-9">Statistics and data transformations</h3>
<div class="outline-text-3" id="text-1-9">
</div><div id="outline-container-sec-1-9-1" class="outline-4">
<h4 id="sec-1-9-1">R</h4>
<div class="outline-text-4" id="text-1-9-1">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(sacha/package-install 'ess)                
(<span class="org-keyword">use-package</span> <span class="org-constant">ess-site</span>
  <span class="org-builtin">:init</span> (setq inferior-R-program-name <span class="org-string">"c:/progra~1/R/R-2.15.0/bin/x64/Rterm.exe"</span>)
  <span class="org-builtin">:commands</span> R)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-9-2" class="outline-4">
<h4 id="sec-1-9-2">Artrage</h4>
<div class="outline-text-4" id="text-1-9-2">
<div class="org-src-container">

<pre class="src src-emacs-lisp">        (<span class="org-keyword">defun</span> <span class="org-function-name">sacha/artrage-export-png</span> (directory <span class="org-type">&amp;optional</span> prefix)
          <span class="org-doc">"Change an Artrage script file (arscript) to export images to DIRECTORY. </span>
<span class="org-doc">    If PREFIX is specified, use that instead of image-."</span>
          (interactive <span class="org-string">"MPath: "</span>)
          (<span class="org-keyword">unless</span> (file-directory-p directory)
            (make-directory directory t))
          (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"[0-9\\.]+s"</span> nil t)
            (replace-match <span class="org-string">"0.000s"</span>))
          (goto-char (point-min))
          (<span class="org-keyword">while</span> (search-forward <span class="org-string">"&lt;StrokeEvent&gt;"</span> nil t)
            (replace-match (concat 
                            <span class="org-string">"EvType: Command    CommandID: ExportLayer    Idx: -1    Channels: NO    Path: \""</span>
                            directory
                            <span class="org-string">"/"</span> (or prefix <span class="org-string">"image-"</span>)
                            <span class="org-string">".png\"</span>
<span class="org-string">&lt;StrokeEvent&gt;"</span>) t t)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-9-3" class="outline-4">
<h4 id="sec-1-9-3">Workrave</h4>
<div class="outline-text-4" id="text-1-9-3">
<div class="org-src-container">

<pre class="src src-emacs-lisp">    (<span class="org-keyword">defvar</span> <span class="org-variable-name">sacha/workrave-file</span> (expand-file-name <span class="org-string">".\\Workrave\\historystats"</span> (getenv <span class="org-string">"AppData"</span>)))

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/workrave-transform-statistics</span> (<span class="org-type">&amp;optional</span> file)
  (interactive (list sacha/workrave-file))
  (<span class="org-keyword">with-current-buffer</span> (find-file-noselect file)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">D day month-1 year hour min day month-1 year hour min</span>
    (<span class="org-keyword">let</span> ((result <span class="org-string">"Date\tStart\tEnd\tClicks\tKeystrokes\n"</span>))
      (goto-char (point-min))
      (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"^D </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> nil t)
        (<span class="org-keyword">let</span> ((dates (split-string (match-string 1))))
          (<span class="org-keyword">if</span> (re-search-forward <span class="org-string">"^m </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span> nil t)
              (<span class="org-keyword">let</span> ((info (split-string (match-string 1))))
                (setq result
                      (concat result
                              (format <span class="org-string">"%d-%d-%s\t%s:%02d\t%s:%02d\t%s\t%s\n"</span>
                                      (+ 1900 (string-to-number (elt dates 2))) <span class="org-comment-delimiter">; </span><span class="org-comment">year</span>
                                      (1+ (string-to-number (elt dates 1))) <span class="org-comment-delimiter">; </span><span class="org-comment">month</span>
                                      (elt dates 0) <span class="org-comment-delimiter">; </span><span class="org-comment">day</span>
                                      (elt dates 3) <span class="org-comment-delimiter">; </span><span class="org-comment">start hour</span>
                                      (string-to-number (elt dates 4)) <span class="org-comment-delimiter">; </span><span class="org-comment">start min</span>
                                      (elt dates 8) <span class="org-comment-delimiter">; </span><span class="org-comment">end hour</span>
                                      (string-to-number (elt dates 9)) <span class="org-comment-delimiter">; </span><span class="org-comment">end min</span>
                                      (elt info 5) <span class="org-comment-delimiter">; </span><span class="org-comment">clicks</span>
                                      (elt info 6) <span class="org-comment-delimiter">; </span><span class="org-comment">keystrokes</span>
                                      )))))))
      (<span class="org-keyword">if</span> (interactive-p)
          (kill-new result)
        result))))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-9-4" class="outline-4">
<h4 id="sec-1-9-4">Blog</h4>
<div class="outline-text-4" id="text-1-9-4">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/strip-blog-share</span> ()
  (interactive)
  (<span class="org-keyword">let</span> (base)
    (<span class="org-keyword">save-excursion</span>
      (goto-char (point-min))
      (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"&lt;div class=\"sharedaddy sd-sharing-enabled\"&gt;.*?&lt;div class=\"sharing-clear\"&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;"</span> nil t)
        (replace-match <span class="org-string">""</span>)))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-1-10" class="outline-3">
<h3 id="sec-1-10">Quantified Awesome</h3>
<div class="outline-text-3" id="text-1-10">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-clock-in-and-track</span> ()
  <span class="org-doc">"Start the clock running. Clock into Quantified Awesome."</span>
  (interactive)
  (<span class="org-keyword">if</span> (derived-mode-p 'org-agenda-mode) (org-agenda-clock-in) (org-clock-in))
  (call-interactively 'sacha/org-quantified-track))
(define-key org-agenda-mode-map <span class="org-string">"!"</span> 'sacha/org-clock-in-and-track)

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-quantified-track</span> (<span class="org-type">&amp;optional</span> category)
  <span class="org-doc">"Create a tracking record using CATEGORY.</span>
<span class="org-doc">      Default to the current task in the agenda, the currently-clocked</span>
<span class="org-doc">      entry, or the current subtree in Org."</span>
  (interactive
   (list
    (or
     (<span class="org-keyword">if</span> (derived-mode-p 'org-agenda-mode)
         (<span class="org-keyword">let*</span> ((marker (org-get-at-bol 'org-marker))
                (buffer (marker-buffer marker))
                (pos (marker-position marker)))
           (<span class="org-keyword">with-current-buffer</span> buffer
             (<span class="org-keyword">save-excursion</span>
               (<span class="org-keyword">save-restriction</span>
                 (widen)
                 (goto-char pos)
                 (org-entry-get-with-inheritance <span class="org-string">"QUANTIFIED"</span>))))))       
     (<span class="org-keyword">if</span> (org-clocking-p)
         (<span class="org-keyword">save-excursion</span>
           (org-clock-goto)
           (org-entry-get-with-inheritance <span class="org-string">"QUANTIFIED"</span>)))
     (<span class="org-keyword">if</span> (derived-mode-p 'org-mode)
         (org-entry-get-with-inheritance <span class="org-string">"QUANTIFIED"</span>))
     (read-string <span class="org-string">"Category: "</span>))))
  (quantified-track (concat category <span class="org-string">" | "</span> (elt (org-heading-components) 4))))
(<span class="org-keyword">use-package</span> <span class="org-constant">quantified</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-11" class="outline-3">
<h3 id="sec-1-11">Beeminder</h3>
<div class="outline-text-3" id="text-1-11">
<p>
<a href="https://github.com/sachac/beeminder.el">https://github.com/sachac/beeminder.el</a>
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(add-to-list 'load-path <span class="org-string">"~/code/beeminder.el"</span>)
(<span class="org-keyword">use-package</span> <span class="org-constant">beeminder</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-12" class="outline-3">
<h3 id="sec-1-12">Workarounds</h3>
<div class="outline-text-3" id="text-1-12">
</div><div id="outline-container-sec-1-12-1" class="outline-4">
<h4 id="sec-1-12-1">color-theme sometimes comes across lists. Odd!</h4>
<div class="outline-text-4" id="text-1-12-1">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice</span> <span class="org-function-name">face-attribute</span> (around sacha activate)
  (<span class="org-keyword">if</span> (symbolp (ad-get-arg 0))
      ad-do-it))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-1-12-2" class="outline-4">
<h4 id="sec-1-12-2">ido-sort-mtime stopped working when I upgraded to Windows 8</h4>
<div class="outline-text-4" id="text-1-12-2">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defadvice</span> <span class="org-function-name">ido-sort-mtime</span> (around sacha activate)
  (setq ido-temp-list
        (sort ido-temp-list 
              (<span class="org-keyword">lambda</span> (a b)
                (<span class="org-keyword">let</span> ((ta (or (nth 5 (file-attributes (concat ido-current-directory a))) '(0 0)))
                      (tb (or (nth 5 (file-attributes (concat ido-current-directory b))) '(0 0))))
                  (<span class="org-keyword">if</span> (= (nth 0 ta) (nth 0 tb))
                      (&gt; (nth 1 ta) (nth 1 tb))
                    (&gt; (nth 0 ta) (nth 0 tb)))))))
  (setq ad-return-value
        (ido-to-end  <span class="org-comment-delimiter">;; </span><span class="org-comment">move . files to end (again)</span>
         (delq nil (mapcar
                    (<span class="org-keyword">lambda</span> (x) (<span class="org-keyword">if</span> (string-equal (substring x 0 1) <span class="org-string">"."</span>) x))
                    ido-temp-list)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-12-3" class="outline-4">
<h4 id="sec-1-12-3">Cygwin mogrify doesn't work for me, but ImageMagick does</h4>
<div class="outline-text-4" id="text-1-12-3">
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;</span><span class="org-comment">(setq eimp-mogrify-program "c:/Program Files/ImageMagick-6.8.3-Q16/mogrify.exe")</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-1-13" class="outline-3">
<h3 id="sec-1-13">Startup</h3>
<div class="outline-text-3" id="text-1-13">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(find-file <span class="org-string">"~/personal/organizer.org"</span>)
(<span class="org-keyword">require</span> '<span class="org-constant">org-compat</span>)
(org-agenda nil <span class="org-string">"a"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-14" class="outline-3">
<h3 id="sec-1-14">Backup</h3>
<div class="outline-text-3" id="text-1-14">
<p>
Disk space is cheap. Save lots.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq delete-old-versions -1)
(setq version-control t)
(setq auto-save-file-name-transforms '((<span class="org-string">".*"</span> <span class="org-string">"~/.emacs.d/auto-save-list"</span> t)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-15" class="outline-3">
<h3 id="sec-1-15">UTF-8</h3>
<div class="outline-text-3" id="text-1-15">
<p>
From <a href="http://www.wisdomandwonder.com/wordpress/wp-content/uploads/2014/03/C3F.html">http://www.wisdomandwonder.com/wordpress/wp-content/uploads/2014/03/C3F.html</a>
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(prefer-coding-system 'utf-8)
(<span class="org-keyword">when</span> (display-graphic-p)
  (setq x-select-request-type '(UTF8_STRING COMPOUND_TEXT TEXT STRING)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-16" class="outline-3">
<h3 id="sec-1-16">Help - guide-key</h3>
<div class="outline-text-3" id="text-1-16">
<p>
It's hard to remember keyboard shortcuts. The <code>guide-key</code> package pops up help after a short delay.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">guide-key</span>
  <span class="org-builtin">:init</span>
  (setq guide-key/guide-key-sequence '(<span class="org-string">"C-x r"</span> <span class="org-string">"C-x 4"</span> <span class="org-string">"C-c"</span>))
  (guide-key-mode 1))  <span class="org-comment-delimiter">; </span><span class="org-comment">Enable guide-key-mode</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-1-17" class="outline-3">
<h3 id="sec-1-17">History</h3>
<div class="outline-text-3" id="text-1-17">
<p>
From <a href="http://www.wisdomandwonder.com/wordpress/wp-content/uploads/2014/03/C3F.html">http://www.wisdomandwonder.com/wordpress/wp-content/uploads/2014/03/C3F.html</a>
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq savehist-file <span class="org-string">"~/.emacs.d/savehist"</span>)
(savehist-mode +1)
(setq savehist-save-minibuffer-history +1)
(setq savehist-additional-variables
      '(kill-ring
        search-ring
        regexp-search-ring))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Inactive/infrequent things</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">Autoconnect to IRC so that I don't forget</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(erc <span class="org-builtin">:server</span> <span class="org-string">"irc.freenode.net"</span> <span class="org-builtin">:port</span> 6667 <span class="org-builtin">:nick</span> <span class="org-string">"sachac"</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">Org - send things to the bottom of the list</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Handy for collecting items together.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-send-to-bottom-of-list</span> ()
  <span class="org-doc">"Send the current line to the bottom of the list."</span>
  (interactive)
  (beginning-of-line)
  (<span class="org-keyword">let</span> ((kill-whole-line t))
    (<span class="org-keyword">save-excursion</span>
      (kill-liune 1)
      (org-end-of-item-list)
      (yank))))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3">Previous weekly review</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">

<pre class="src src-emacs-lisp">  (<span class="org-keyword">defvar</span> <span class="org-variable-name">sacha/org-quantified-categories</span> 
    '((<span class="org-string">"Business"</span> 
       (<span class="org-string">"Earn"</span> . <span class="org-string">"Business - Earn"</span>) 
       (<span class="org-string">"E1"</span> . <span class="org-string">"Business - Earn - Consulting - E1"</span>) 
       (<span class="org-string">"Connect"</span> . <span class="org-string">"Business - Connect"</span>) 
       (<span class="org-string">"Build"</span> . <span class="org-string">"Business - Build"</span>))
      (<span class="org-string">"Discretionary"</span>
       (<span class="org-string">"Social"</span> . <span class="org-string">"Discretionary - Social"</span>)
       (<span class="org-string">"Productive"</span> . <span class="org-string">"Discretionary - Productive"</span>)
       (<span class="org-string">"Writing"</span> . <span class="org-string">"Discretionary - Productive - Writing"</span>)
       (<span class="org-string">"Emacs"</span> . <span class="org-string">"Discretionary - Productive - Emacs"</span>)
       (<span class="org-string">"Play"</span> . <span class="org-string">"Discretionary - Play"</span>))
      (<span class="org-string">"Personal"</span> <span class="org-comment-delimiter">;</span><span class="org-comment">("Biking" . "Personal - Bike")</span>
       (<span class="org-string">"Routines"</span> . <span class="org-string">"Personal - Routines"</span>))
      (<span class="org-string">"Sleep"</span> nil)
      (<span class="org-string">"Unpaid work"</span> 
       (<span class="org-string">"Commuting"</span> . <span class="org-string">"Unpaid work - Subway"</span>)
       (<span class="org-string">"Cook"</span> . <span class="org-string">"Unpaid work - Cook"</span>)
       (<span class="org-string">"Tidy"</span> . <span class="org-string">"Unpaid work - Tidy up"</span>)))
    <span class="org-doc">"Categories for time summary."</span>)

  (<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-summarize-time-use</span> (<span class="org-type">&amp;optional</span> start end)
    (<span class="org-keyword">require</span> '<span class="org-constant">quantified</span>)
    (interactive)
    (<span class="org-keyword">unless</span> start (setq start (format-time-string <span class="org-string">"%Y-%m-%d"</span> (days-to-time (- (time-to-number-of-days base-date) 6)))))
    (<span class="org-keyword">unless</span> end (setq end (format-time-string <span class="org-string">"%Y-%m-%d"</span> (days-to-time (1+ (time-to-number-of-days base-date))))))
    (<span class="org-keyword">let</span> ((time-summary (quantified-summarize-time start end))
          (categories sacha/org-quantified-categories)
          result)
      (setq result
            (mapconcat
             (<span class="org-keyword">lambda</span> (a)
               (<span class="org-keyword">if</span> (assoc (car a) time-summary)
                   (concat
                    (format <span class="org-string">"- %s: %.1f hours"</span> (car a) (/ (cdr (assoc (car a) time-summary)) 3600.0))
                    (<span class="org-keyword">if</span> (cdr a)
                        (<span class="org-keyword">let</span> ((detail
                               (delq nil
                                     (mapcar (<span class="org-keyword">lambda</span> (b)
                                               (<span class="org-keyword">if</span> (assoc (cdr b) time-summary)
                                                   (format <span class="org-string">"%s: %.1f"</span>
                                                           (car b)
                                                           (/ (cdr (assoc (cdr b) time-summary)) 3600.0))
                                                 nil))
                                             (cdr a)))))
                          (<span class="org-keyword">if</span> detail
                              (concat <span class="org-string">" ("</span> (mapconcat 'identity detail <span class="org-string">", "</span>) <span class="org-string">")"</span>)
                            <span class="org-string">""</span>))
                      <span class="org-string">""</span>)
                    (<span class="org-keyword">if</span> (string-equal (car a) <span class="org-string">"Sleep"</span>)
                        (format <span class="org-string">" - average of %.1f hours per day"</span> (/ (cdr (assoc (car a) time-summary)) 3600.0 7.0))
                      <span class="org-string">""</span>)
                    <span class="org-string">"\n"</span>)))
       categories <span class="org-string">""</span>))
(<span class="org-keyword">if</span> (called-interactively-p)
    (insert result)
  result)))
</pre>
</div>

<p>
List upcoming tasks so that I can see if I'm overloaded.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-summarize-upcoming-week</span> ()
  <span class="org-doc">"Summarize upcoming tasks as a list."</span>
  (interactive)
  (org-agenda nil <span class="org-string">"w"</span>)
  (<span class="org-keyword">let</span> ((string (buffer-string))
        business relationships life)
    (<span class="org-keyword">with-temp-buffer</span>
      (insert string)
      (goto-char (point-min))
      (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"^  </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">:]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">: +</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">Sched[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">:]+: +</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?TODO </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">[      ]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">:[[:alnum:]_@#%:]+:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?[        ]*$"</span> nil t)
        (<span class="org-keyword">cond</span>
         ((string= (match-string 1) <span class="org-string">"routines"</span>) nil) <span class="org-comment-delimiter">; </span><span class="org-comment">skip routine tasks</span>
         ((string= (match-string 1) <span class="org-string">"business"</span>)
          (add-to-list 'business (concat <span class="org-string">"  - [ ] "</span> (match-string 3))))
         ((string= (match-string 1) <span class="org-string">"people"</span>)
          (add-to-list 'relationships (concat <span class="org-string">"  - [ ] "</span> (match-string 3))))
         (t (add-to-list 'life (concat <span class="org-string">"  - [ ] "</span> (match-string 3)))))))
    (setq string
          (concat
      <span class="org-string">"*Plans for next week*\n"</span>
      <span class="org-string">"- Business\n"</span>
      (mapconcat 'identity business <span class="org-string">"\n"</span>)
      <span class="org-string">"\n- Relationships\n"</span>
      (mapconcat 'identity relationships <span class="org-string">"\n"</span>)
      <span class="org-string">"\n- Life\n"</span>
      (mapconcat 'identity life <span class="org-string">"\n"</span>)))
    (<span class="org-keyword">if</span> (called-interactively-p)
        (kill-new string)
      string)))
</pre>
</div>

<p>
This uses Org Agenda's log mode to summarize the tasks that I checked
off. I still need to match it up with the plans for the previous week
to see which items I'd planned ahead, and which ones were new tasks.
(Hmm, is it important to track those separately? I might just skip it.)
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-summarize-previous-week</span> ()
  <span class="org-doc">"Summarize previously-completed tasks as a list."</span>
  (interactive)
  (<span class="org-keyword">save-window-excursion</span>
    (org-agenda nil <span class="org-string">"w"</span>)
    (org-agenda-later -1)
    (org-agenda-log-mode 16)
    (<span class="org-keyword">let</span> ((string (buffer-string))
          business relationships life)
      (<span class="org-keyword">with-temp-buffer</span>
        (insert string)
      (goto-char (point-min))
      (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"^  </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">:]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">: +.*?State:.*?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">TODO</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">DONE</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"> </span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(?:</span></span><span class="org-string">[       ]+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">:[[:alnum:]_@#%:]+:</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">?[        ]*$"</span> nil t)
        (<span class="org-keyword">cond</span>
         ((string= (match-string 1) <span class="org-string">"routines"</span>) nil) <span class="org-comment-delimiter">; </span><span class="org-comment">skip routine tasks</span>
         ((string= (match-string 1) <span class="org-string">"business"</span>)
          (add-to-list 'business (concat <span class="org-string">"  - "</span> (match-string 2))))
         ((string= (match-string 1) <span class="org-string">"people"</span>)
          (add-to-list 'relationships (concat <span class="org-string">"  - "</span> (match-string 2))))
         (t (add-to-list 'life (concat <span class="org-string">"  - "</span> (match-string 2)))))))
    (setq string
          (concat
           <span class="org-string">"*Accomplished this week*\n\n"</span>
           <span class="org-string">"- Business\n"</span>
           (mapconcat 'identity business <span class="org-string">"\n"</span>)
           <span class="org-string">"\n- Relationships\n"</span>
           (mapconcat 'identity relationships <span class="org-string">"\n"</span>)
           <span class="org-string">"\n- Life\n"</span>
           (mapconcat 'identity life <span class="org-string">"\n"</span>)))
    (<span class="org-keyword">if</span> (called-interactively-p)
        (kill-new string)
      string))))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4">Animation for Emacs chats</h3>
<div class="outline-text-3" id="text-2-4">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/animate-emacs-chat</span> ()
  (interactive)
  (text-scale-set 6)
  (erase-buffer)
  (sit-for 3)
  (<span class="org-keyword">let</span> ((list '(<span class="org-string">"Emacs Chat: Sacha Chua"</span>
                <span class="org-string">"interviewed by Bastien Guerry"</span>
                <span class="org-string">""</span>
                <span class="org-string">"July 24, 2013"</span>
                <span class="org-string">"sachachua.com/emacs-chat"</span>))
        (approx-width 41)
        (approx-height 16)
        row)
    (setq row (/ (- approx-height (length list)) 2))
    (mapcar
     (<span class="org-keyword">lambda</span> (x)
       (animate-string x
                       row
                       (/ (- approx-width (length x)) 2))
       (setq row (1+ row)))
     list)))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5">Idle timer</h3>
<div class="outline-text-3" id="text-2-5">
<p>
This snippet is from John Wiegley -
<a href="http://lists.gnu.org/archive/html/emacs-orgmode/2010-03/msg00367.html">http://lists.gnu.org/archive/html/emacs-orgmode/2010-03/msg00367.html</a>.
It shows the org agenda when Emacs is idle.
</p>

<p>
Thanks to winner-mode, I can get back to my previous buffers with C-c
left.
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">jump-to-org-agenda</span> ()
  (interactive)
  (<span class="org-keyword">let</span> ((buf (get-buffer <span class="org-string">"*Org Agenda*"</span>))
        wind)
    (<span class="org-keyword">if</span> buf
        (<span class="org-keyword">if</span> (setq wind (get-buffer-window buf))
            (select-window wind)
          (<span class="org-keyword">if</span> (called-interactively-p)
              (<span class="org-keyword">progn</span>
                (select-window (display-buffer buf t t))
                (org-fit-window-to-buffer)
                <span class="org-comment-delimiter">;; </span><span class="org-comment">(org-agenda-redo)</span>
                )
            (<span class="org-keyword">with-selected-window</span> (display-buffer buf)
              (org-fit-window-to-buffer)
              <span class="org-comment-delimiter">;; </span><span class="org-comment">(org-agenda-redo)</span>
              )))
      (call-interactively 'org-agenda-list)))
  <span class="org-comment-delimiter">;;</span><span class="org-comment">(let ((buf (get-buffer "*Calendar*")))</span>
  <span class="org-comment-delimiter">;;  </span><span class="org-comment">(unless (get-buffer-window buf)</span>
  <span class="org-comment-delimiter">;;    </span><span class="org-comment">(org-agenda-goto-calendar)))</span>
  )

(run-with-idle-timer 300 t 'jump-to-org-agenda)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-6" class="outline-3">
<h3 id="sec-2-6">Old Flickr/Evernote export</h3>
<div class="outline-text-3" id="text-2-6">
<div class="org-src-container">

<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">I don't use these as much now that I have the functions above.</span>
(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/evernote-extract-links</span> (filename)
  <span class="org-doc">"Extract note names and URLs from an ENEX file."</span>
  (interactive)

  (goto-char (point-min))
  (<span class="org-keyword">let</span> (list)
    (<span class="org-keyword">while</span> (re-search-forward <span class="org-string">"&lt;title&gt;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.+?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">&lt;/title&gt;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*?\n</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">*?.*?href=\"</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">\""</span> nil t)
      (setq list (cons (cons (match-string-no-properties 1) (match-string-no-properties 3)) list)))
    (delete-region (point-min) (point-max))
    (insert (mapconcat (<span class="org-keyword">lambda</span> (x) (concat <span class="org-string">"- [["</span> (cdr x) <span class="org-string">"]["</span> (car x) <span class="org-string">"]]"</span>)) list <span class="org-string">"\n"</span>))))      

(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/flickr-extract-this-week</span> ()
  <span class="org-doc">"Extract this week's sketch titles and URLs from the flickr_metadata CSV."</span>
  (interactive)
  (<span class="org-keyword">let</span> ((base-date (apply 'encode-time (org-read-date-analyze <span class="org-string">"-fri"</span> nil '(0 0 0))))
        start end list)
    (setq start (format-time-string <span class="org-string">"%Y-%m-%d"</span> (days-to-time (- (time-to-number-of-days base-date) 6))))
    (setq end (format-time-string <span class="org-string">"%Y-%m-%d"</span> (days-to-time (1+ (time-to-number-of-days base-date)))))
    (setq list (csv-parse-buffer t))
    (erase-buffer)
    (insert
     (mapconcat (<span class="org-keyword">lambda</span> (x) (concat <span class="org-string">"- [["</span> (car x) <span class="org-string">"]["</span> (cdr x) <span class="org-string">"]]"</span>))
                (sort
                 (delq nil
                       (mapcar (<span class="org-keyword">lambda</span> (x)
                                 (<span class="org-keyword">let</span> ((title (cdr (assoc <span class="org-string">"FileName"</span> x))))
                                   (<span class="org-keyword">if</span> (and (not (string&lt; title start))
                                            (string&lt; title end))
                                       (cons (cdr (assoc <span class="org-string">"URL"</span> x)) title))))
                               list))
                 (<span class="org-keyword">lambda</span> (a b) (string&lt;  (cdr a) (cdr b)))
                 )
                <span class="org-string">"\n"</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2-7" class="outline-3">
<h3 id="sec-2-7">Presentation code for Emacs Conference</h3>
<div class="outline-text-3" id="text-2-7">
<p>
<a id="emacsconf2013"></a>
</p>

<div class="org-src-container">

<pre class="src src-:eval">(defvar sacha/org-show-presentation-file "~/Dropbox/Emacs Conference/public.org" "File containing the presentation.")
(defvar sacha/org-show-slide-tag "slide" "Tag that marks slides.")
(defvar sacha/org-show-slide-tag-regexp (concat ":" (regexp-quote sacha/org-show-slide-tag) ":"))
(require 'eimp)

;; From org-pres--eimp-fit
(defun sacha/org-show-eimp-fit ()
  "Function used as a hook, fits the image found to the window."
  (when (eq major-mode 'image-mode)
    (eimp-fit-image-to-window nil)))
(add-hook 'find-file-hook 'sacha/org-show-eimp-fit)

(defun sacha/org-show-execute-slide ()
  "Process slide at point.
  If it contains an Emacs Lisp source block, evaluate it.
  If it contains an image, view it and switch to that buffer.
  Else, focus on that buffer.
  Hide all drawers."
  (interactive)
  (find-file sacha/org-show-presentation-file)
  (org-narrow-to-subtree)
  (visual-line-mode)
  (let ((heading-text (nth 4 (org-heading-components))))
    (cond
     ;; view images
     ((and (goto-char (point-min))
	   (re-search-forward "\\[\\[.*\\.\\(jpg\\|gif\\|png\\)" nil t))
      (delete-other-windows)
      (let ((org-link-frame-setup '((file . find-file))))
	(org-open-at-point))
      (delete-other-windows)
      (goto-char (point-min)))
     ;; find and execute source code blocks
     ((and (goto-char (point-min))
	   (re-search-forward "#\\+begin_src" nil t))
      (let ((info (org-babel-get-src-block-info)))
	(unwind-protect
	    (eval (read (concat "(progn " (nth 1 info) ")"))))))
     (t
      (switch-to-buffer (current-buffer))
      (text-scale-set 4)
      (org-show-subtree)
      (org-cycle-hide-drawers t)
      (org-display-inline-images)
      (delete-other-windows)))
    (set-frame-name heading-text)))

(defun sacha/org-show-next-slide ()
  "Show the next slide."
  (interactive)
  (find-file sacha/org-show-presentation-file)
  (widen)
  (goto-char (line-end-position))
  (when (re-search-forward sacha/org-show-slide-tag-regexp nil t)
    (sacha/org-show-execute-slide)))

(defun sacha/org-show-previous-slide ()
  "Show the next slide."
  (interactive)
  (find-file sacha/org-show-presentation-file)
  (widen)
  (goto-char (line-beginning-position))
  (when (re-search-backward sacha/org-show-slide-tag-regexp nil t)
    (sacha/org-show-execute-slide)))

(global-set-key '[f5] 'sacha/org-show-previous-slide)
(global-set-key '[f6] 'sacha/org-show-execute-slide)
(global-set-key '[f7] 'sacha/org-show-next-slide)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-2-8" class="outline-3">
<h3 id="sec-2-8">Enable minibuffer completion</h3>
<div class="outline-text-3" id="text-2-8">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2013-03-31]</span></span> Superseded by ido-hacks?
</p>

<p>
It can be difficult to remember the full names of Emacs commands, so I
use <code>icomplete-mode</code> for minibuffer completion. This also makes it
easier to discover commands.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(icomplete-mode 1)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-2-9" class="outline-3">
<h3 id="sec-2-9">Because I'm trying to use helm instead of ido&#x2026;</h3>
<div class="outline-text-3" id="text-2-9">
</div><div id="outline-container-sec-2-9-1" class="outline-4">
<h4 id="sec-2-9-1">Ido-mode: Much better navigationy things</h4>
<div class="outline-text-4" id="text-2-9-1">
<p>
<span class="timestamp-wrapper"><span class="timestamp">[2013-03-31]</span></span>: Let's try using Helm instead.
</p>

<p>
Ido-mode is awesome. Let's make it awesomer. I usually want to go to
recently-opened files first.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">ido</span>
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">progn</span>
  (ido-mode 1)
  (setq ido-default-buffer-method 'selected-window)
  (add-hook 'ido-make-file-list-hook 'ido-sort-mtime)
  (add-hook 'ido-make-dir-list-hook 'ido-sort-mtime)
  (<span class="org-keyword">defun</span> <span class="org-function-name">ido-sort-mtime</span> ()
    (setq ido-temp-list
          (sort ido-temp-list 
                (<span class="org-keyword">lambda</span> (a b)
                  (<span class="org-keyword">let</span> ((ta (nth 5 (file-attributes (concat ido-current-directory a))))
                        (tb (nth 5 (file-attributes (concat ido-current-directory b)))))
                    (<span class="org-keyword">if</span> (= (nth 0 ta) (nth 0 tb))
                        (&gt; (nth 1 ta) (nth 1 tb))
                      (&gt; (nth 0 ta) (nth 0 tb)))))))
    (ido-to-end  <span class="org-comment-delimiter">;; </span><span class="org-comment">move . files to end (again)</span>
     (delq nil (mapcar
                (<span class="org-keyword">lambda</span> (x) (<span class="org-keyword">if</span> (string-equal (substring x 0 1) <span class="org-string">"."</span>) x))
                ido-temp-list))))))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-2-9-2" class="outline-4">
<h4 id="sec-2-9-2">Ido and Org</h4>
<div class="outline-text-4" id="text-2-9-2">
<p>
When I use <code>org-refile</code> to organize my notes, I like seeing the
latest entries on top. Ido-related and verify-related snippets
are from "Using ido-mode for org-refile (and archiving via
refile)" in <a href="http://orgmode.org/worg/org-hacks.html">Org Hacks</a>.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq ido-everywhere t)
(setq ido-enable-flex-matching t)
(setq ido-max-directory-size 100000)
(ido-mode (quote both))
(setq org-completion-us-ido t)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-2-9-3" class="outline-4">
<h4 id="sec-2-9-3">Finding files</h4>
<div class="outline-text-4" id="text-2-9-3">
<p>
I don't want to think about directory structures, I just want to
open files. 
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">filecache</span>)
(<span class="org-keyword">require</span> '<span class="org-constant">ido</span>)
(<span class="org-keyword">defun</span> <span class="org-function-name">file-cache-ido-find-file</span> (file)
  <span class="org-doc">"Using ido, interactively open file from file cache'.</span>
<span class="org-doc">First select a file, matched using ido-switch-buffer against the contents</span>
<span class="org-doc">in `</span><span class="org-doc"><span class="org-constant">file-cache-alist</span></span><span class="org-doc">'. If the file exist in more than one</span>
<span class="org-doc">directory, select directory. Lastly the file is opened."</span>
  (interactive (list (file-cache-ido-read <span class="org-string">"File: "</span>
                                          (mapcar
                                           (<span class="org-keyword">lambda</span> (x)
                                             (car x))
                                           file-cache-alist))))
  (<span class="org-keyword">let*</span> ((record (assoc file file-cache-alist)))
    (find-file
     (expand-file-name
      file
      (<span class="org-keyword">if</span> (= (length record) 2)
          (car (cdr record))
        (file-cache-ido-read
         (format <span class="org-string">"Find %s in dir: "</span> file) (cdr record)))))))

(<span class="org-keyword">defun</span> <span class="org-function-name">file-cache-ido-read</span> (prompt choices)
  (<span class="org-keyword">let</span> ((ido-make-buffer-list-hook
         (<span class="org-keyword">lambda</span> ()
           (setq ido-temp-list choices))))
    (ido-read-buffer prompt)))
(add-to-list 'file-cache-filter-regexps <span class="org-string">"docs/html"</span>)
(add-to-list 'file-cache-filter-regexps <span class="org-string">"\\.svn-base$"</span>)
(add-to-list 'file-cache-filter-regexps <span class="org-string">"\\.dump$"</span>)
</pre>
</div>

<p>
To use this code, I add something like
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(sacha/file-cache-setup-tree <span class="org-string">"sacha/proj1"</span> <span class="org-string">"C-c d"</span>
                             '(<span class="org-string">"/dir1"</span>
                               <span class="org-string">"/dir2"</span>))
</pre>
</div>
<p>
to my config. Then <code>C-c d</code> (or whatever keyboard shortcut I use)
searches for files within the specified directories.
</p>
</div>
</div>
</div>
<div id="outline-container-sec-2-10" class="outline-3">
<h3 id="sec-2-10">Keywiz - keyboard quizzes</h3>
<div class="outline-text-3" id="text-2-10">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">keywiz</span>)
(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/load-keybindings</span> ()
  <span class="org-doc">"Since we don't want to have to pass through a keywiz game each time..."</span>
  (setq keywiz-cached-commands nil)
  (do-all-symbols (sym)
    (<span class="org-keyword">when</span> (and (commandp sym)
               (not (memq sym '(self-insert-command
                                digit-argument undefined))))
      (<span class="org-keyword">let</span> ((keys (apply 'nconc (mapcar
                                 (<span class="org-keyword">lambda</span> (key)
                                   (<span class="org-keyword">when</span> (keywiz-key-press-event-p key)
                                     (list key)))
                                 (where-is-internal sym)))))
        <span class="org-comment-delimiter">;;  </span><span class="org-comment">Politically incorrect, but clearer version of the above:</span>
        <span class="org-comment-delimiter">;;    </span><span class="org-comment">(let ((keys (delete-if-not 'keywiz-key-press-event-p</span>
        <span class="org-comment-delimiter">;;                               </span><span class="org-comment">(where-is-internal sym))))</span>
        (and keys
             (push (list sym keys) keywiz-cached-commands))))))
(sacha/load-keybindings)
<span class="org-comment-delimiter">;; </span><span class="org-comment">Might be good to use this in org-agenda...</span>
(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/random-keybinding</span> ()
  <span class="org-doc">"Describe a random keybinding."</span>
  (<span class="org-keyword">let*</span> ((command (keywiz-random keywiz-cached-commands))
         (doc (and command (documentation (car command)))))
    (<span class="org-keyword">if</span> command
        (concat (symbol-name (car command)) <span class="org-string">" "</span>
                <span class="org-string">"("</span> (mapconcat 'key-description (cadr command) <span class="org-string">", "</span>) <span class="org-string">")"</span>
                (<span class="org-keyword">if</span> doc
                    (concat <span class="org-string">": "</span> (substring doc 0 (string-match <span class="org-string">"\n"</span> doc)))
                  <span class="org-string">""</span>))
      <span class="org-string">""</span>)))
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-2-11" class="outline-3">
<h3 id="sec-2-11">Work-in-progress: monthly review</h3>
<div class="outline-text-3" id="text-2-11">
<p>
&#x2026; and for good measure, let's do some kind of monthly review too.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">sacha/org-prepare-monthly-review</span> ()
  <span class="org-doc">"Prepare monthly review template."</span>
  (interactive)
  (<span class="org-keyword">let*</span> ((base-date (org-read-date-analyze <span class="org-string">"-1m"</span> nil '(0 0 0)))
         (start (encode-time 0 0 0 1 (elt base-date 4) (elt base-date 5)))
         (end (encode-time 0 0 0 1 (1+ (elt base-date 4)) (elt base-date 5)))
         (org-agenda-files '(<span class="org-string">"~/personal/organizer.org"</span> <span class="org-string">"~/personal/business.org"</span> <span class="org-string">"~/personal/people.org"</span>)))
    (<span class="org-keyword">save-window-excursion</span>
      (kill-new
       (concat
        <span class="org-string">"*** Monthly review: "</span> (format-time-string <span class="org-string">"%B %Y"</span> base-date) <span class="org-string">"  :monthly:\n"</span>
        <span class="org-string">"*Blog posts*\n\n"</span>
        <span class="org-string">"*Time review*\n"</span>
        (sacha/org-summarize-time-use
         (format-time-string <span class="org-string">"%Y-%m-%d"</span> start)
         (format-time-string <span class="org-string">"%Y-%m-%d"</span> end)
         (float-time (time-subtract end start))
        <span class="org-string">"\n"</span>)))
    (yank))))
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Other nifty Emacs things I want to learn</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><a id="ID-bfdaf129-f64c-49be-8848-a0e0300fdfdb"></a>Finding the closest Makefile&#xa0;&#xa0;&#xa0;<span class="tag"><span class="drill">drill</span></span></h3>
<div class="outline-text-3" id="text-3-1">
<p>
Look up the directory hierarchy from FILE for a file named NAME.
Stop at the first parent directory containing a file NAME,
and return the directory.  Return nil if not found.
</p>
</div>

<div id="outline-container-sec-3-1-1" class="outline-4">
<h4 id="sec-3-1-1">Answer</h4>
<div class="outline-text-4" id="text-3-1-1">
<p>
<code>find-dominating-file</code>
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">iedit</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">iedit</span>)
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3">Smartparens mode&#xa0;&#xa0;&#xa0;<span class="tag"><span class="drill">drill</span></span></h3>
<div class="outline-text-3" id="text-3-3">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span class="org-keyword">use-package</span> <span class="org-constant">smartparens</span>
  <span class="org-builtin">:init</span> 
  (<span class="org-keyword">progn</span>
    (<span class="org-keyword">require</span> '<span class="org-constant">smartparens-config</span>)
    (add-hook 'emacs-lisp-mode-hook 'smartparens-mode)
    (add-hook 'emacs-lisp-mode-hook 'show-smartparens-mode)

<span class="org-comment-delimiter">;;;;;;;;;;;;;;;;;;;;;;;;</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">keybinding management</span>

    (define-key sp-keymap (kbd <span class="org-string">"C-M-f"</span>) 'sp-forward-sexp)
    (define-key sp-keymap (kbd <span class="org-string">"C-M-b"</span>) 'sp-backward-sexp)

    (define-key sp-keymap (kbd <span class="org-string">"C-M-d"</span>) 'sp-down-sexp)
    (define-key sp-keymap (kbd <span class="org-string">"C-M-a"</span>) 'sp-backward-down-sexp)
    (define-key sp-keymap (kbd <span class="org-string">"C-S-a"</span>) 'sp-beginning-of-sexp)
    (define-key sp-keymap (kbd <span class="org-string">"C-S-d"</span>) 'sp-end-of-sexp)

    (define-key sp-keymap (kbd <span class="org-string">"C-M-e"</span>) 'sp-up-sexp)
    (define-key emacs-lisp-mode-map (kbd <span class="org-string">")"</span>) 'sp-up-sexp)
    (define-key sp-keymap (kbd <span class="org-string">"C-M-u"</span>) 'sp-backward-up-sexp)
    (define-key sp-keymap (kbd <span class="org-string">"C-M-t"</span>) 'sp-transpose-sexp)

    (define-key sp-keymap (kbd <span class="org-string">"C-M-n"</span>) 'sp-next-sexp)
    (define-key sp-keymap (kbd <span class="org-string">"C-M-p"</span>) 'sp-previous-sexp)

    (define-key sp-keymap (kbd <span class="org-string">"C-M-k"</span>) 'sp-kill-sexp)
    (define-key sp-keymap (kbd <span class="org-string">"C-M-w"</span>) 'sp-copy-sexp)

    (define-key sp-keymap (kbd <span class="org-string">"M-&lt;delete&gt;"</span>) 'sp-unwrap-sexp)
    (define-key sp-keymap (kbd <span class="org-string">"M-&lt;backspace&gt;"</span>) 'sp-backward-unwrap-sexp)

    (define-key sp-keymap (kbd <span class="org-string">"C-&lt;right&gt;"</span>) 'sp-forward-slurp-sexp)
    (define-key sp-keymap (kbd <span class="org-string">"C-&lt;left&gt;"</span>) 'sp-forward-barf-sexp)
    (define-key sp-keymap (kbd <span class="org-string">"C-M-&lt;left&gt;"</span>) 'sp-backward-slurp-sexp)
    (define-key sp-keymap (kbd <span class="org-string">"C-M-&lt;right&gt;"</span>) 'sp-backward-barf-sexp)

    (define-key sp-keymap (kbd <span class="org-string">"M-D"</span>) 'sp-splice-sexp)
    (define-key sp-keymap (kbd <span class="org-string">"C-M-&lt;delete&gt;"</span>) 'sp-splice-sexp-killing-forward)
    (define-key sp-keymap (kbd <span class="org-string">"C-M-&lt;backspace&gt;"</span>) 'sp-splice-sexp-killing-backward)
    (define-key sp-keymap (kbd <span class="org-string">"C-S-&lt;backspace&gt;"</span>) 'sp-splice-sexp-killing-around)

    (define-key sp-keymap (kbd <span class="org-string">"C-]"</span>) 'sp-select-next-thing-exchange)
    (define-key sp-keymap (kbd <span class="org-string">"C-&lt;left_bracket&gt;"</span>) 'sp-select-previous-thing)
    (define-key sp-keymap (kbd <span class="org-string">"C-M-]"</span>) 'sp-select-next-thing)

    (define-key sp-keymap (kbd <span class="org-string">"M-F"</span>) 'sp-forward-symbol)
    (define-key sp-keymap (kbd <span class="org-string">"M-B"</span>) 'sp-backward-symbol)

    (define-key sp-keymap (kbd <span class="org-string">"H-t"</span>) 'sp-prefix-tag-object)
    (define-key sp-keymap (kbd <span class="org-string">"H-p"</span>) 'sp-prefix-pair-object)
    (define-key sp-keymap (kbd <span class="org-string">"H-s c"</span>) 'sp-convolute-sexp)
    (define-key sp-keymap (kbd <span class="org-string">"H-s a"</span>) 'sp-absorb-sexp)
    (define-key sp-keymap (kbd <span class="org-string">"H-s e"</span>) 'sp-emit-sexp)
    (define-key sp-keymap (kbd <span class="org-string">"H-s p"</span>) 'sp-add-to-previous-sexp)
    (define-key sp-keymap (kbd <span class="org-string">"H-s n"</span>) 'sp-add-to-next-sexp)
    (define-key sp-keymap (kbd <span class="org-string">"H-s j"</span>) 'sp-join-sexp)
    (define-key sp-keymap (kbd <span class="org-string">"H-s s"</span>) 'sp-split-sexp)

<span class="org-comment-delimiter">;;;;;;;;;;;;;;;;;;</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">pair management</span>

    (sp-local-pair 'minibuffer-inactive-mode <span class="org-string">"'"</span> nil <span class="org-builtin">:actions</span> nil)

<span class="org-comment-delimiter">;;; </span><span class="org-comment">markdown-mode</span>
    (<span class="org-keyword">sp-with-modes</span> '(markdown-mode gfm-mode rst-mode)
      (sp-local-pair <span class="org-string">"*"</span> <span class="org-string">"*"</span> <span class="org-builtin">:bind</span> <span class="org-string">"C-*"</span>)
      (sp-local-tag <span class="org-string">"2"</span> <span class="org-string">"**"</span> <span class="org-string">"**"</span>)
      (sp-local-tag <span class="org-string">"s"</span> <span class="org-string">"```scheme"</span> <span class="org-string">"```"</span>)
      (sp-local-tag <span class="org-string">"&lt;"</span>  <span class="org-string">"&lt;_&gt;"</span> <span class="org-string">"&lt;/_&gt;"</span> <span class="org-builtin">:transform</span> 'sp-match-sgml-tags))

<span class="org-comment-delimiter">;;; </span><span class="org-comment">tex-mode latex-mode</span>
    (<span class="org-keyword">sp-with-modes</span> '(tex-mode plain-tex-mode latex-mode)
      (sp-local-tag <span class="org-string">"i"</span> <span class="org-string">"1d5f8e69396c521f645375107197ea4dfbc7b792quot;&lt;"</span> <span class="org-string">"1d5f8e69396c521f645375107197ea4dfbc7b792quot;&gt;"</span>))

<span class="org-comment-delimiter">;;; </span><span class="org-comment">html-mode</span>
    (<span class="org-keyword">sp-with-modes</span> '(html-mode sgml-mode)
      (sp-local-pair <span class="org-string">"&lt;"</span> <span class="org-string">"&gt;"</span>))

<span class="org-comment-delimiter">;;; </span><span class="org-comment">lisp modes</span>
    (<span class="org-keyword">sp-with-modes</span> sp--lisp-modes
      (sp-local-pair <span class="org-string">"("</span> nil <span class="org-builtin">:bind</span> <span class="org-string">"C-("</span>))))
</pre>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
